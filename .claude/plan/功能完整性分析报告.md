# MuMuAINovel åŠŸèƒ½å®Œæ•´æ€§åˆ†ææŠ¥å‘Š

**åˆ†ææ—¶é—´**: 2025-11-04
**åˆ†æèŒƒå›´**: åŠŸèƒ½å®Œæ•´æ€§ï¼ˆç°æœ‰åŠŸèƒ½å®Œå–„åº¦ã€ç¼ºå¤±åŠŸèƒ½è¯†åˆ«ï¼‰
**åˆ†ææ–¹æ³•**: ä»£ç å®¡æŸ¥ã€æ¶æ„åˆ†æã€ä¸šåŠ¡æµç¨‹è¯„ä¼°
**åˆ†æå·¥å…·**: Claude Sonnet 4.5 + Serena MCP

---

## ä¸€ã€æ‰§è¡Œæ‘˜è¦

MuMuAINovel æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œå–„çš„ AI å°è¯´åˆ›ä½œåŠ©æ‰‹ï¼Œå·²å®ç°**æ ¸å¿ƒåˆ›ä½œæµç¨‹**çš„ä¸»è¦åŠŸèƒ½æ¨¡å—ã€‚ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤š AI æä¾›å•†ï¼Œå…·å¤‡å‘å¯¼å¼åˆ›ä½œã€ç« èŠ‚ç®¡ç†ã€è§’è‰²ç®¡ç†ã€RAG è®°å¿†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### æ€»ä½“è¯„ä¼°

| è¯„ä¼°ç»´åº¦ | å®Œæˆåº¦ | è¯´æ˜ |
|---------|-------|------|
| **æ ¸å¿ƒåŠŸèƒ½å®Œæ•´åº¦** | âœ… 85% | é•¿ç¯‡å°è¯´åˆ›ä½œçš„ä¸»æµç¨‹å·²å®Œå–„ |
| **åŠŸèƒ½è¦†ç›–å¹¿åº¦** | âš ï¸ 60% | ç¼ºå°‘çŸ­ç¯‡å°è¯´æ”¯æŒã€çµæ„Ÿæ¨¡å¼ã€é«˜çº§åä½œç­‰åŠŸèƒ½ |
| **å·²å®ç°åŠŸèƒ½è´¨é‡** | âœ… è‰¯å¥½ | ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¸šåŠ¡é€»è¾‘å®Œæ•´ |
| **ç”¨æˆ·ä½“éªŒå¢å¼º** | âš ï¸ éœ€æ”¹è¿› | ç¼ºå°‘è‡ªåŠ¨ä¿å­˜ã€æ‰¹é‡æ“ä½œã€å…¨å±€æœç´¢ç­‰ä¾¿æ·åŠŸèƒ½ |

---

## äºŒã€å·²å®ç°åŠŸèƒ½æ¸…å•

### âœ… æ ¸å¿ƒåˆ›ä½œæµç¨‹ï¼ˆå®Œå–„åº¦ï¼š90%ï¼‰

1. **é¡¹ç›®ç®¡ç†**
   - CRUD å®Œæ•´å®ç°
   - æ•°æ®å¯¼å…¥å¯¼å‡ºï¼ˆJSONæ ¼å¼ï¼‰
   - æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å’Œä¿®å¤
   - é¡¹ç›®çŠ¶æ€ç®¡ç†ï¼ˆplanning/writing/revising/completedï¼‰

2. **å‘å¯¼å¼åˆ›å»º**
   - SSE æµå¼ç”Ÿæˆä¸–ç•Œè§‚
   - æµå¼ç”Ÿæˆè§’è‰²ï¼ˆ5ä¸ªèµ·ï¼‰
   - æµå¼ç”Ÿæˆå¤§çº²
   - æ”¯æŒæ¢å¤æœªå®Œæˆå‘å¯¼

3. **ç« èŠ‚ç®¡ç†**
   - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç« èŠ‚
   - AI æµå¼ç”Ÿæˆç« èŠ‚å†…å®¹
   - ç« èŠ‚å¯¼èˆªï¼ˆä¸Šä¸€ç« /ä¸‹ä¸€ç« ï¼‰
   - å­—æ•°ç»Ÿè®¡å’Œè¿›åº¦è¿½è¸ª
   - å‰ç½®ç« èŠ‚ä¾èµ–æ£€æŸ¥
   - å¯¼å‡ºä¸º TXT æ ¼å¼

4. **å¤§çº²ç®¡ç†**
   - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å¤§çº²
   - AI ç”Ÿæˆæ–°å¤§çº²
   - AI ç»­å†™å¤§çº²
   - å¤§çº²æ’åºï¼ˆorder_indexï¼‰

5. **è§’è‰²ç®¡ç†**
   - è§’è‰² CRUD
   - AI ç”Ÿæˆè§’è‰²
   - è§’è‰²å…³ç³»ç®¡ç†ï¼ˆCharacterRelationshipï¼‰
   - å…³ç³»ç±»å‹ç®¡ç†ï¼ˆçˆ¶å­ã€æœ‹å‹ã€æ•Œå¯¹ç­‰ï¼‰
   - å…³ç³»å›¾è°±å¯è§†åŒ–

6. **ç»„ç»‡ç®¡ç†**
   - ç»„ç»‡ CRUD
   - ç»„ç»‡æˆå‘˜ç®¡ç†
   - æˆå‘˜èŒä½å’Œè§’è‰²è®¾å®š

### âœ… AI èƒ½åŠ›ï¼ˆå®Œå–„åº¦ï¼š85%ï¼‰

1. **å¤šæ¨¡å‹æ”¯æŒ**
   - OpenAIï¼ˆåŒ…æ‹¬ä¸­è½¬ APIï¼‰
   - Anthropic Claude
   - Google Gemini
   - Deepseekï¼ˆç‰¹æ®Šå¤„ç† reasoning_contentï¼‰

2. **å†™ä½œé£æ ¼ç®¡ç†**
   - 6 ç§é¢„è®¾é£æ ¼ï¼ˆå¤å…¸æ–‡å­¦ã€ç°ä»£éƒ½å¸‚ã€å¥‡å¹»å†’é™©ã€ç§‘å¹»æœªæ¥ã€æ‚¬ç–‘æ¨ç†ã€è¨€æƒ…æµªæ¼«ï¼‰
   - è‡ªå®šä¹‰å†™ä½œé£æ ¼
   - é¡¹ç›®é»˜è®¤é£æ ¼è®¾ç½®
   - é£æ ¼åº”ç”¨äºå„ç±»ç”Ÿæˆä»»åŠ¡

3. **æ–‡æœ¬å¤„ç†**
   - å•ä¸ªæ–‡æœ¬æ¶¦è‰²
   - æ‰¹é‡æ–‡æœ¬æ¶¦è‰²
   - æ”¯æŒè‡ªå®šä¹‰æ¶¦è‰²è¦æ±‚

4. **RAG è®°å¿†ç³»ç»Ÿ**
   - ç« èŠ‚å‰§æƒ…åˆ†æ
   - æ•…äº‹è®°å¿†å­˜å‚¨ï¼ˆChromaDB + sentence-transformersï¼‰
   - è¯­ä¹‰æœç´¢
   - ä¼ç¬”ç®¡ç†ï¼ˆæœªè§£å†³ä¼ç¬”è¿½è¸ªï¼‰
   - è®°å¿†ç»Ÿè®¡

5. **æµå¼ç”Ÿæˆ**
   - SSEï¼ˆServer-Sent Eventsï¼‰å®æ—¶æ¨é€
   - å‰ç«¯è¿›åº¦æ¡å±•ç¤º
   - ç”Ÿæˆå†å²è®°å½•

### âœ… ç”¨æˆ·ä½“éªŒï¼ˆå®Œå–„åº¦ï¼š70%ï¼‰

1. **èº«ä»½è®¤è¯**
   - LinuxDO OAuth2 ç™»å½•
   - æœ¬åœ°è´¦æˆ·ç™»å½•
   - ä¼šè¯ç®¡ç†ï¼ˆtoken-basedï¼‰
   - ä¼šè¯è‡ªåŠ¨åˆ·æ–°

2. **ç”¨æˆ·ç•Œé¢**
   - Ant Design ç»„ä»¶åº“
   - å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰
   - æ·±è‰²æ¨¡å¼æ”¯æŒï¼ˆCardStylesï¼‰
   - SSE åŠ è½½åŠ¨ç”»

3. **æ•°æ®å®‰å…¨**
   - å¤šç”¨æˆ·æ•°æ®éš”ç¦»ï¼ˆuser_id çº§åˆ«æ•°æ®åº“ï¼‰
   - ä¼šè¯è¿‡æœŸæ§åˆ¶ï¼ˆé»˜è®¤ 120 åˆ†é’Ÿï¼‰
   - æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

4. **ç³»ç»Ÿé…ç½®**
   - AI æœåŠ¡é…ç½®ç®¡ç†
   - API æµ‹è¯•åŠŸèƒ½
   - å¯ç”¨æ¨¡å‹åˆ—è¡¨

---

## ä¸‰ã€åŠŸèƒ½ç¼ºå¤±ä¸ä¸å®Œå–„åˆ†æ

ä»¥ä¸‹æŒ‰**å½±å“èŒƒå›´**å’Œ**å®ç°ä¼˜å…ˆçº§**è¿›è¡Œåˆ†ç±»ï¼š

---

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆP0ï¼‰- å½±å“æ ¸å¿ƒä½“éªŒ

#### 1. çŸ­ç¯‡å°è¯´æ”¯æŒç¼ºå¤±

**é—®é¢˜æè¿°**:
- å½“å‰é¡¹ç›®å›ºå®šä¸ºé•¿ç¯‡å°è¯´æ¶æ„ï¼ˆé»˜è®¤30ç« ã€10ä¸‡å­—ï¼‰
- æ²¡æœ‰é¡¹ç›®ç±»å‹åŒºåˆ†ï¼ˆé•¿ç¯‡/ä¸­ç¯‡/çŸ­ç¯‡/å¾®å°è¯´ï¼‰
- çŸ­ç¯‡å°è¯´ï¼ˆ1-5ç« ã€5000-30000å­—ï¼‰æ— æ³•é€‚é…å½“å‰å‘å¯¼æµç¨‹
- ç« èŠ‚å¿…é¡»æŒ‰é¡ºåºç”Ÿæˆï¼ˆå‰ç½®ç« èŠ‚ä¾èµ–ï¼‰ï¼Œä¸é€‚åˆçŸ­ç¯‡è‡ªç”±åˆ›ä½œ

**æ ¹æœ¬åŸå› **:
- `Project` æ¨¡å‹ç¼ºå°‘ `project_type` å­—æ®µ
- å‘å¯¼æµç¨‹ `ProjectWizardNew.tsx` ç¡¬ç¼–ç äº†é•¿ç¯‡å°è¯´çš„åˆ›å»ºé€»è¾‘ï¼ˆchapter_count é»˜è®¤30ï¼‰
- å‰ç«¯è¡¨å•é™åˆ¶ç« èŠ‚æ•°èŒƒå›´ä¸çµæ´»
- ç« èŠ‚ç”Ÿæˆé€»è¾‘å¼ºåˆ¶ä¾èµ–å‰ç½®ç« èŠ‚ï¼ˆ`backend/app/api/chapters.py:73-83`ï¼‰

**å½±å“èŒƒå›´**:
- **ç”¨æˆ·ç¾¤ä½“**: çŸ­ç¯‡å°è¯´ä½œè€…ã€å¾®å°è¯´åˆ›ä½œè€…æ— æ³•ä½¿ç”¨æœ¬ç³»ç»Ÿ
- **å¸‚åœºå®šä½**: é™åˆ¶äº†äº§å“é€‚ç”¨åœºæ™¯ï¼Œé™ä½å¸‚åœºè¦†ç›–ç‡
- **åŠŸèƒ½æ‰©å±•**: å½±å“åç»­å¾®å°è¯´ã€å‰§æœ¬ã€è¯—æ­Œç­‰å†…å®¹ç±»å‹æ”¯æŒ

**æ¶‰åŠæ–‡ä»¶**:
- `backend/app/models/project.py:7-37` - Project æ¨¡å‹å®šä¹‰
- `backend/app/schemas/project.py:67-76` - ProjectWizardRequest
- `frontend/src/pages/ProjectWizardNew.tsx:50-59` - å‘å¯¼åŸºç¡€é…ç½®
- `backend/app/api/chapters.py:73-83` - ç« èŠ‚å‰ç½®ä¾èµ–é€»è¾‘

**å»ºè®®æ–¹æ¡ˆ**:

1. **æ•°æ®æ¨¡å‹å¢å¼º**:
   ```python
   # backend/app/models/project.py
   project_type = Column(String(20), default='long_novel', nullable=False)
   # å¯é€‰å€¼: 'long_novel', 'medium_novel', 'short_story', 'micro_fiction'
   ```

2. **å‘å¯¼æµç¨‹æ”¹é€ **:
   - ç¬¬ä¸€æ­¥å¢åŠ "é¡¹ç›®ç±»å‹"é€‰æ‹©
   - æ ¹æ®ç±»å‹åŠ¨æ€è°ƒæ•´ç« èŠ‚æ•°èŒƒå›´ï¼š
     - å¾®å°è¯´: 1ç« ï¼ˆ500-3000å­—ï¼‰
     - çŸ­ç¯‡: 1-10ç« ï¼ˆ5000-30000å­—ï¼‰
     - ä¸­ç¯‡: 10-30ç« ï¼ˆ30000-100000å­—ï¼‰
     - é•¿ç¯‡: 30+ç« ï¼ˆ100000å­—+ï¼‰
   - çŸ­ç¯‡æ¨¡å¼ç®€åŒ–ä¸–ç•Œè§‚ç”Ÿæˆï¼ˆå¯é€‰å¡«ï¼‰

3. **ç« èŠ‚ç”Ÿæˆé€»è¾‘ä¼˜åŒ–**:
   ```python
   # backend/app/api/chapters.py
   def check_can_generate(chapter, project):
       if project.project_type in ['short_story', 'micro_fiction']:
           return True  # çŸ­ç¯‡æ¨¡å¼å–æ¶ˆé¡ºåºé™åˆ¶
       # é•¿ç¯‡ä¿æŒåŸæœ‰å‰ç½®ç« èŠ‚æ£€æŸ¥é€»è¾‘
   ```

4. **å‰ç«¯ä½“éªŒä¼˜åŒ–**:
   - ç« èŠ‚åˆ—è¡¨å¢åŠ "é¡¹ç›®ç±»å‹"æ ‡è¯†
   - çŸ­ç¯‡æ¨¡å¼æ˜¾ç¤º"è‡ªç”±ç”Ÿæˆ"æç¤º
   - å­—æ•°å»ºè®®æ ¹æ®ç±»å‹åŠ¨æ€è°ƒæ•´

**ä¼˜å…ˆçº§ç†ç”±**:
- ç›´æ¥æ‰©å¤§ç”¨æˆ·ç¾¤ä½“ï¼Œæå‡äº§å“ç«äº‰åŠ›
- å®ç°æˆæœ¬å¯æ§ï¼ˆä¸»è¦ä¸ºé…ç½®è°ƒæ•´ï¼‰
- ç”¨æˆ·å‘¼å£°é«˜ï¼ˆå¯å‚è€ƒ issue åé¦ˆï¼‰

---

#### 2. ç« èŠ‚ç¼–è¾‘è‡ªåŠ¨ä¿å­˜ç¼ºå¤±

**é—®é¢˜æè¿°**:
- ç« èŠ‚ç¼–è¾‘å™¨æ— è‡ªåŠ¨ä¿å­˜æœºåˆ¶
- ç”¨æˆ·éœ€æ‰‹åŠ¨ç‚¹å‡»"ä¿å­˜"æŒ‰é’®ï¼Œå®¹æ˜“å¿˜è®°
- æµè§ˆå™¨å´©æºƒã€ç½‘ç»œä¸­æ–­ã€è¯¯å…³é—­æ ‡ç­¾é¡µå¯¼è‡´å†…å®¹ä¸¢å¤±
- é•¿æ—¶é—´ç¼–è¾‘ï¼ˆ30åˆ†é’Ÿ+ï¼‰é£é™©æé«˜

**æ ¹æœ¬åŸå› **:
- å‰ç«¯ `Chapters.tsx` çš„ç¼–è¾‘å™¨ï¼ˆTextAreaï¼‰æœªå®ç°é˜²æŠ–è‡ªåŠ¨ä¿å­˜
- ç¼ºå°‘ LocalStorage æœ¬åœ°ç¼“å­˜æœºåˆ¶
- æ— "æœªä¿å­˜"çŠ¶æ€æç¤º
- æ— é¡µé¢å…³é—­å‰çš„ç¡®è®¤æ‹¦æˆª

**å½±å“èŒƒå›´**:
- **ç”¨æˆ·ä½“éªŒ**: ä¸¥é‡å½±å“é•¿æ—¶é—´ç¼–è¾‘åœºæ™¯ï¼ˆç”¨æˆ·æ ¸å¿ƒç—›ç‚¹ï¼‰
- **æ•°æ®å®‰å…¨**: å†…å®¹ä¸¢å¤±å¯¼è‡´ç”¨æˆ·æµå¤±
- **å£ç¢‘å½±å“**: æ•°æ®ä¸¢å¤±ä½“éªŒæå·®ï¼Œå½±å“äº§å“è¯„ä»·

**æ¶‰åŠæ–‡ä»¶**:
- `frontend/src/pages/Chapters.tsx:13-28` - ç« èŠ‚ç¼–è¾‘çŠ¶æ€ç®¡ç†
- `frontend/src/services/api.ts` - API è°ƒç”¨å±‚

**å»ºè®®æ–¹æ¡ˆ**:

1. **é˜²æŠ–è‡ªåŠ¨ä¿å­˜**:
   ```typescript
   // åœ¨ Chapters.tsx ä¸­æ·»åŠ 
   const autoSaveDebounce = useDebounce(async (content) => {
     await chapterApi.update(chapterId, { content });
     message.success('è‡ªåŠ¨ä¿å­˜æˆåŠŸ', 1);
   }, 2000); // ç¼–è¾‘åœæ­¢ 2 ç§’åä¿å­˜
   ```

2. **LocalStorage æœ¬åœ°ç¼“å­˜**:
   ```typescript
   // ç¼–è¾‘æ—¶å®æ—¶ç¼“å­˜
   localStorage.setItem(`chapter_draft_${chapterId}`, content);

   // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è‰ç¨¿
   useEffect(() => {
     const draft = localStorage.getItem(`chapter_draft_${chapterId}`);
     if (draft && draft !== originalContent) {
       Modal.confirm({
         title: 'å‘ç°æœªä¿å­˜çš„è‰ç¨¿',
         content: 'æ˜¯å¦æ¢å¤ä¸Šæ¬¡ç¼–è¾‘å†…å®¹ï¼Ÿ',
         onOk: () => setContent(draft)
       });
     }
   }, [chapterId]);
   ```

3. **æœªä¿å­˜æç¤º**:
   ```typescript
   // æ ‡ç­¾é¡µå…³é—­å‰ç¡®è®¤
   useEffect(() => {
     const handleBeforeUnload = (e) => {
       if (hasUnsavedChanges) {
         e.preventDefault();
         e.returnValue = 'æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
       }
     };
     window.addEventListener('beforeunload', handleBeforeUnload);
     return () => window.removeEventListener('beforeunload', handleBeforeUnload);
   }, [hasUnsavedChanges]);
   ```

4. **çŠ¶æ€æŒ‡ç¤ºå™¨**:
   - ç¼–è¾‘å™¨å³ä¸Šè§’æ˜¾ç¤ºä¿å­˜çŠ¶æ€ï¼ˆ"å·²ä¿å­˜"/"ä¿å­˜ä¸­"/"æœªä¿å­˜"ï¼‰
   - ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡è¯†ï¼ˆç»¿è‰²/é»„è‰²/çº¢è‰²ï¼‰

**ä¼˜å…ˆçº§ç†ç”±**:
- ç”¨æˆ·æ ¸å¿ƒç—›ç‚¹ï¼Œç›´æ¥å½±å“å†™ä½œä½“éªŒ
- å®ç°æˆæœ¬ä½ï¼ŒæŠ€æœ¯æˆç†Ÿ
- é˜²æ­¢æ•°æ®ä¸¢å¤±çš„åŸºç¡€åŠŸèƒ½

---

#### 3. å…¨å±€æœç´¢åŠŸèƒ½ç¼ºå¤±

**é—®é¢˜æè¿°**:
- æ— æ³•å¿«é€Ÿæœç´¢é¡¹ç›®å†…çš„ç« èŠ‚ã€è§’è‰²ã€å¤§çº²å†…å®¹
- å¤§å‹é¡¹ç›®ï¼ˆ50+ç« èŠ‚ï¼‰éš¾ä»¥å¿«é€Ÿå®šä½ç‰¹å®šå†…å®¹
- æŸ¥æ‰¾è§’è‰²å‡ºåœºç« èŠ‚ã€ä¼ç¬”ä½ç½®æ•ˆç‡æä½
- æ— æ³•æœç´¢å…³é”®è¯åœ¨å“ªäº›ç« èŠ‚å‡ºç°

**æ ¹æœ¬åŸå› **:
- åç«¯æœªå®ç°å…¨æ–‡æœç´¢ API
- å‰ç«¯ç¼ºå°‘å…¨å±€æœç´¢å…¥å£å’Œç»„ä»¶
- æ•°æ®åº“æœªå»ºç«‹å…¨æ–‡ç´¢å¼•ï¼ˆSQLite FTSï¼‰

**å½±å“èŒƒå›´**:
- **å¤§å‹é¡¹ç›®**: 50ç« ä»¥ä¸Šé¡¹ç›®ç®¡ç†å›°éš¾
- **åˆ›ä½œæ•ˆç‡**: æŸ¥æ‰¾ä¿¡æ¯è€—æ—¶ï¼Œæ‰“æ–­åˆ›ä½œæµç¨‹
- **å†…å®¹ä¸€è‡´æ€§**: éš¾ä»¥æ£€æŸ¥è§’è‰²åç§°ã€åœ°åæ‹¼å†™ä¸€è‡´æ€§

**æ¶‰åŠæ–‡ä»¶**:
- `backend/app/api/` - éœ€æ–°å¢ search.py
- `frontend/src/components/` - éœ€æ–°å¢ GlobalSearch.tsx
- `frontend/src/App.tsx` - æ·»åŠ å…¨å±€æœç´¢å¿«æ·é”®

**å»ºè®®æ–¹æ¡ˆ**:

1. **åç«¯æœç´¢ API**:
   ```python
   # backend/app/api/search.py
   @router.get("/search")
   async def global_search(
       q: str,  # æœç´¢å…³é”®è¯
       project_id: str,
       scope: str = "all",  # all/chapters/characters/outlines
       db: AsyncSession = Depends(get_db)
   ):
       results = {
           "chapters": [],
           "characters": [],
           "outlines": []
       }

       # ç« èŠ‚æœç´¢ï¼ˆæ ‡é¢˜+å†…å®¹ï¼‰
       if scope in ["all", "chapters"]:
           stmt = select(Chapter).where(
               Chapter.project_id == project_id,
               or_(
                   Chapter.title.ilike(f"%{q}%"),
                   Chapter.content.ilike(f"%{q}%")
               )
           )
           chapters = await db.execute(stmt)
           results["chapters"] = chapters.scalars().all()

       # è§’è‰²æœç´¢ï¼ˆåç§°+èƒŒæ™¯+æ€§æ ¼ï¼‰
       if scope in ["all", "characters"]:
           # ç±»ä¼¼å®ç°...

       return results
   ```

2. **å‰ç«¯å…¨å±€æœç´¢ç»„ä»¶**:
   ```typescript
   // å¿«æ·é”® Ctrl+K æˆ– Cmd+K
   const GlobalSearch = () => {
     const [open, setOpen] = useState(false);
     const [results, setResults] = useState([]);

     useEffect(() => {
       const handleKeyDown = (e) => {
         if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
           e.preventDefault();
           setOpen(true);
         }
       };
       document.addEventListener('keydown', handleKeyDown);
       return () => document.removeEventListener('keydown', handleKeyDown);
     }, []);

     return (
       <Modal open={open} onCancel={() => setOpen(false)}>
         <Input.Search
           placeholder="æœç´¢ç« èŠ‚ã€è§’è‰²ã€å¤§çº²..."
           onChange={debounce(handleSearch, 300)}
         />
         <SearchResults results={results} />
       </Modal>
     );
   };
   ```

3. **æœç´¢ç»“æœå±•ç¤º**:
   - æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºï¼ˆç« èŠ‚/è§’è‰²/å¤§çº²ï¼‰
   - é«˜äº®åŒ¹é…å…³é”®è¯
   - æ˜¾ç¤ºä¸Šä¸‹æ–‡ç‰‡æ®µï¼ˆå‰å20å­—ï¼‰
   - ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”é¡µé¢

4. **é«˜çº§æœç´¢é€‰é¡¹**:
   - èŒƒå›´è¿‡æ»¤ï¼ˆä»…ç« èŠ‚/ä»…è§’è‰²ï¼‰
   - æ—¶é—´è¿‡æ»¤ï¼ˆæœ€è¿‘ç¼–è¾‘ï¼‰
   - æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ

**ä¼˜å…ˆçº§ç†ç”±**:
- å½±å“ä¸­å¤§å‹é¡¹ç›®å¯ç”¨æ€§
- æå‡åˆ›ä½œæ•ˆç‡ï¼Œå‡å°‘æŸ¥æ‰¾æ—¶é—´
- ç”¨æˆ·é«˜é¢‘éœ€æ±‚

---

### ğŸŸ  ä¸­ä¼˜å…ˆçº§ï¼ˆP1ï¼‰- å¢å¼ºåŠŸèƒ½ä½“éªŒ

#### 4. çµæ„Ÿæ¨¡å¼æœªå®ç°

**é—®é¢˜æè¿°**:
- README TODO ä¸­æåˆ°ä½†æœªå®ç°
- åˆ›ä½œè€…ç¼ºå°‘ç‚¹å­ç”Ÿæˆã€æƒ…èŠ‚å¯å‘å·¥å…·
- é‡åˆ°åˆ›ä½œç“¶é¢ˆæ—¶æ— è¾…åŠ©æ‰‹æ®µ
- æ— è§’è‰²åç§°ã€åœ°åã€ç»„ç»‡åç§°ç”Ÿæˆå·¥å…·

**æ ¹æœ¬åŸå› **:
- åŠŸèƒ½è§„åˆ’ä¸­ä½†æœªå¼€å‘
- ç¼ºå°‘"çµæ„Ÿåº“"æ•°æ®æ¨¡å‹å’Œé¡µé¢

**å½±å“èŒƒå›´**:
- **åˆ›ä½œè¾…åŠ©**: ç¼ºå°‘åˆ›æ„æ¿€å‘å·¥å…·
- **å·®å¼‚åŒ–**: ç«å“å¯èƒ½æœ‰ç±»ä¼¼åŠŸèƒ½ï¼ˆå¦‚ NovelAI çš„ Lorebookï¼‰
- **ç”¨æˆ·ç²˜æ€§**: æ— æ³•æä¾›é¢å¤–åˆ›ä½œä»·å€¼

**æ¶‰åŠæ–‡ä»¶**:
- éœ€æ–°å¢ `backend/app/models/inspiration.py`
- éœ€æ–°å¢ `backend/app/api/inspiration.py`
- éœ€æ–°å¢ `frontend/src/pages/Inspiration.tsx`

**å»ºè®®æ–¹æ¡ˆ**:

1. **æ•°æ®æ¨¡å‹è®¾è®¡**:
   ```python
   # backend/app/models/inspiration.py
   class Inspiration(Base):
       __tablename__ = "inspirations"

       id = Column(String(36), primary_key=True)
       project_id = Column(String(36), ForeignKey("projects.id"))
       type = Column(String(20))  # plot/character/name/worldbuilding
       content = Column(Text)
       tags = Column(String(200))  # é€—å·åˆ†éš”
       is_used = Column(Boolean, default=False)
       created_at = Column(DateTime)
   ```

2. **AI ç”ŸæˆåŠŸèƒ½**:
   - **æƒ…èŠ‚ç‚¹å­ç”Ÿæˆ**: åŸºäºé¡¹ç›®ä¸»é¢˜å’Œå¤§çº²ç”Ÿæˆå†²çª/è½¬æŠ˜ç‚¹
   - **è§’è‰²åç§°ç”Ÿæˆ**: æ ¹æ®æ€§åˆ«ã€å›½ç±ã€æ—¶ä»£èƒŒæ™¯ç”Ÿæˆ
   - **ä¸–ç•Œè§‚å…ƒç´ **: ç”Ÿæˆåœ°åã€ç»„ç»‡åã€é­”æ³•ä½“ç³»ç­‰
   - **å†²çªæƒ…èŠ‚**: ç”Ÿæˆè§’è‰²é—´çŸ›ç›¾ã€å¤–éƒ¨å†²çª
   - **å¼€åœº/ç»“å±€çµæ„Ÿ**: ç”Ÿæˆå¼€å¤´æ®µè½ã€ç»“å±€èµ°å‘

3. **çµæ„Ÿåº“ç•Œé¢**:
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ çµæ„Ÿåº“ ğŸ¨                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ [ç”Ÿæˆæ–°çµæ„Ÿ â–¼]  [ç­›é€‰: å…¨éƒ¨ â–¼]    â”‚
   â”‚                                     â”‚
   â”‚ â”Œâ”€ æƒ…èŠ‚ç‚¹å­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ ä¸»è§’å‘ç°ä¸–ç•Œçš„çœŸç›¸...        â”‚   â”‚
   â”‚ â”‚ [ä½¿ç”¨] [æ”¶è—] [åˆ é™¤]         â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                                     â”‚
   â”‚ â”Œâ”€ è§’è‰²åç§° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ ææ¸…é£ï¼ˆä»™ä¾ é£æ ¼ï¼‰           â”‚   â”‚
   â”‚ â”‚ [ä½¿ç”¨] [æ”¶è—] [åˆ é™¤]         â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

4. **ä½¿ç”¨åœºæ™¯é›†æˆ**:
   - ç« èŠ‚ç”Ÿæˆæ—¶å¯é€‰æ‹©ä½¿ç”¨çµæ„Ÿä½œä¸ºå‚è€ƒ
   - è§’è‰²åˆ›å»ºæ—¶å¯å¿«é€Ÿå¡«å……åç§°
   - å¤§çº²ç¼–è¾‘æ—¶æ’å…¥æƒ…èŠ‚ç‚¹å­

**ä¼˜å…ˆçº§ç†ç”±**:
- æå‡åˆ›ä½œè¾…åŠ©èƒ½åŠ›
- å¢å¼ºäº§å“ç«äº‰åŠ›
- ç”¨æˆ·ä»·å€¼æ˜ç¡®

---

#### 5. Promptæ¨¡æ¿è°ƒæ•´ç•Œé¢ç¼ºå¤±

**é—®é¢˜æè¿°**:
- Prompt ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼ˆ`wizard_stream.py`, `chapters.py` ç­‰ï¼‰
- ç”¨æˆ·æ— æ³•è‡ªå®šä¹‰ AI æç¤ºè¯
- é«˜çº§ç”¨æˆ·æ— æ³•ç²¾ç»†è°ƒæ§ AI è¾“å‡º
- ä¸æ”¯æŒå¤šè¯­è¨€ Prompt
- Prompt ä¼˜åŒ–éœ€è¦ä¿®æ”¹ä»£ç å¹¶é‡å¯æœåŠ¡

**æ ¹æœ¬åŸå› **:
- æœªè®¾è®¡ Prompt ç®¡ç†ç³»ç»Ÿ
- ç¼ºå°‘å‰ç«¯å¯è§†åŒ–ç¼–è¾‘ç•Œé¢
- Prompt ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆ

**å½±å“èŒƒå›´**:
- **é«˜çº§ç”¨æˆ·**: æ— æ³•ç²¾ç»†è°ƒæ§ AI è¾“å‡ºè´¨é‡
- **å¤šè¯­è¨€**: ä¸æ”¯æŒè‹±æ–‡ã€æ—¥æ–‡ç­‰éä¸­æ–‡åˆ›ä½œ
- **å¯ç»´æŠ¤æ€§**: Prompt ä¿®æ”¹éœ€æ”¹ä»£ç ï¼Œé£é™©é«˜
- **è¿­ä»£æ•ˆç‡**: æ— æ³•å¿«é€Ÿæµ‹è¯•ä¸åŒ Prompt æ•ˆæœ

**æ¶‰åŠæ–‡ä»¶**:
- `backend/app/api/wizard_stream.py:50-150` - å‘å¯¼ Prompt
- `backend/app/api/chapters.py:200-300` - ç« èŠ‚ç”Ÿæˆ Prompt
- `backend/app/api/outlines.py` - å¤§çº²ç”Ÿæˆ Prompt

**å»ºè®®æ–¹æ¡ˆ**:

1. **æ•°æ®æ¨¡å‹è®¾è®¡**:
   ```python
   # backend/app/models/prompt_template.py
   class PromptTemplate(Base):
       __tablename__ = "prompt_templates"

       id = Column(String(36), primary_key=True)
       name = Column(String(100), unique=True)  # world_building, character_gen
       description = Column(String(200))
       template = Column(Text)  # æ”¯æŒå˜é‡: {project_title}, {theme}
       variables = Column(JSON)  # å˜é‡å®šä¹‰å’Œé»˜è®¤å€¼
       category = Column(String(50))  # wizard/chapter/outline/character
       is_system = Column(Boolean, default=False)  # ç³»ç»Ÿé¢„è®¾ä¸å¯åˆ é™¤
       created_at = Column(DateTime)
       updated_at = Column(DateTime)
   ```

2. **å˜é‡æ›¿æ¢å¼•æ“**:
   ```python
   # backend/app/services/prompt_service.py
   class PromptTemplateEngine:
       def render(self, template: str, context: dict) -> str:
           """
           æ›¿æ¢æ¨¡æ¿å˜é‡
           ç¤ºä¾‹:
             template = "è¯·ä¸º{project_title}ç”Ÿæˆ{character_count}ä¸ªè§’è‰²"
             context = {"project_title": "ä»™ä¾ ä¼ ", "character_count": 5}
             -> "è¯·ä¸ºä»™ä¾ ä¼ ç”Ÿæˆ5ä¸ªè§’è‰²"
           """
           return template.format(**context)

       def validate_template(self, template: str) -> bool:
           """éªŒè¯æ¨¡æ¿è¯­æ³•"""
           try:
               template.format(**{})
               return True
           except:
               return False
   ```

3. **å‰ç«¯ç¼–è¾‘ç•Œé¢**:
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Prompt æ¨¡æ¿ç®¡ç†                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ åˆ†ç±»: [å‘å¯¼] [ç« èŠ‚] [å¤§çº²] [è§’è‰²]      â”‚
   â”‚                                         â”‚
   â”‚ â”Œâ”€ ä¸–ç•Œè§‚ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚ â”‚ è¯·ä¸ºå°è¯´ã€Š{project_title}ã€‹ç”Ÿæˆ   â”‚  â”‚
   â”‚ â”‚ ä¸–ç•Œè§‚è®¾å®šï¼Œä¸»é¢˜æ˜¯{theme}...       â”‚  â”‚
   â”‚ â”‚                                   â”‚  â”‚
   â”‚ â”‚ å¯ç”¨å˜é‡:                         â”‚  â”‚
   â”‚ â”‚ - {project_title}: é¡¹ç›®æ ‡é¢˜      â”‚  â”‚
   â”‚ â”‚ - {theme}: ä¸»é¢˜                  â”‚  â”‚
   â”‚ â”‚ - {genre}: ç±»å‹                  â”‚  â”‚
   â”‚ â”‚                                   â”‚  â”‚
   â”‚ â”‚ [é¢„è§ˆ] [æµ‹è¯•] [ä¿å­˜] [æ¢å¤é»˜è®¤]  â”‚  â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

4. **åŠŸèƒ½ç‰¹æ€§**:
   - è¯­æ³•é«˜äº®ï¼ˆå˜é‡æ ‡è¯†ï¼‰
   - å®æ—¶é¢„è§ˆï¼ˆå˜é‡æ›¿æ¢æ•ˆæœï¼‰
   - æµ‹è¯•åŠŸèƒ½ï¼ˆè°ƒç”¨ AI æŸ¥çœ‹å®é™…æ•ˆæœï¼‰
   - ç‰ˆæœ¬ç®¡ç†ï¼ˆä¿å­˜å†å²ç‰ˆæœ¬ï¼‰
   - å¯¼å…¥/å¯¼å‡ºï¼ˆJSON æ ¼å¼ï¼‰
   - ç¤¾åŒºæ¨¡æ¿åº“ï¼ˆåˆ†äº«ä¼˜è´¨ Promptï¼‰

5. **ç³»ç»Ÿé¢„è®¾æ¨¡æ¿**:
   - ä¸–ç•Œè§‚ç”Ÿæˆ
   - è§’è‰²ç”Ÿæˆ
   - å¤§çº²ç”Ÿæˆ
   - ç« èŠ‚å†…å®¹ç”Ÿæˆ
   - æ–‡æœ¬æ¶¦è‰²
   - ç»­å†™å»ºè®®

**ä¼˜å…ˆçº§ç†ç”±**:
- æå‡é«˜çº§ç”¨æˆ·æ»¡æ„åº¦
- å¢å¼ºç³»ç»Ÿçµæ´»æ€§
- é™ä½ç»´æŠ¤æˆæœ¬
- æ”¯æŒç¤¾åŒºè´¡çŒ®

---

#### 6. æ‰¹é‡æ“ä½œåŠŸèƒ½ä¸è¶³

**é—®é¢˜æè¿°**:
- æ— æ‰¹é‡åˆ é™¤ç« èŠ‚ã€è§’è‰²ã€å¤§çº²
- æ— æ‰¹é‡å¯¼å‡ºç« èŠ‚ä¸ºå•ç‹¬æ–‡ä»¶
- æ— æ‰¹é‡ä¿®æ”¹ç« èŠ‚çŠ¶æ€ï¼ˆå¦‚å…¨éƒ¨æ ‡è®°ä¸º"å·²å®Œæˆ"ï¼‰
- æ— æ‰¹é‡åº”ç”¨å†™ä½œé£æ ¼
- åˆ é™¤æµ‹è¯•æ•°æ®éœ€é€ä¸ªæ“ä½œ

**æ ¹æœ¬åŸå› **:
- API å±‚é¢ä»…æ”¯æŒå•ä¸ªæ“ä½œ
- å‰ç«¯æœªå®ç°æ‰¹é‡é€‰æ‹© UIï¼ˆCheckboxï¼‰
- ç¼ºå°‘æ‰¹é‡æ“ä½œç«¯ç‚¹

**å½±å“èŒƒå›´**:
- **å¤§å‹é¡¹ç›®**: 50+ç« èŠ‚ç®¡ç†æ•ˆç‡ä½
- **æ•°æ®æ¸…ç†**: æ¸…ç†æµ‹è¯•æ•°æ®ç¹ç
- **å†…å®¹ç®¡ç†**: æ‰¹é‡æ•´ç†è€—æ—¶

**æ¶‰åŠæ–‡ä»¶**:
- `backend/app/api/chapters.py` - éœ€æ–°å¢æ‰¹é‡ç«¯ç‚¹
- `frontend/src/pages/Chapters.tsx` - éœ€æ·»åŠ å¤šé€‰åŠŸèƒ½

**å»ºè®®æ–¹æ¡ˆ**:

1. **åç«¯æ‰¹é‡ API**:
   ```python
   # backend/app/api/chapters.py

   @router.post("/batch-delete", summary="æ‰¹é‡åˆ é™¤ç« èŠ‚")
   async def batch_delete_chapters(
       chapter_ids: List[str],
       db: AsyncSession = Depends(get_db)
   ):
       """æ‰¹é‡åˆ é™¤ç« èŠ‚"""
       deleted_count = 0
       for chapter_id in chapter_ids:
           result = await db.execute(
               select(Chapter).where(Chapter.id == chapter_id)
           )
           chapter = result.scalar_one_or_none()
           if chapter:
               await db.delete(chapter)
               deleted_count += 1

       await db.commit()
       return {"deleted_count": deleted_count}

   @router.post("/batch-update-status", summary="æ‰¹é‡æ›´æ–°ç« èŠ‚çŠ¶æ€")
   async def batch_update_status(
       chapter_ids: List[str],
       status: str,  # draft/completed/revised
       db: AsyncSession = Depends(get_db)
   ):
       """æ‰¹é‡æ›´æ–°ç« èŠ‚çŠ¶æ€"""
       # å®ç°é€»è¾‘...

   @router.post("/batch-export", summary="æ‰¹é‡å¯¼å‡ºç« èŠ‚")
   async def batch_export_chapters(
       chapter_ids: List[str],
       format: str = "zip",  # zip/txt/markdown
       db: AsyncSession = Depends(get_db)
   ):
       """æ‰¹é‡å¯¼å‡ºç« èŠ‚ä¸ºå‹ç¼©åŒ…"""
       # å®ç°é€»è¾‘...
   ```

2. **å‰ç«¯å¤šé€‰åŠŸèƒ½**:
   ```typescript
   // frontend/src/pages/Chapters.tsx
   const [selectedIds, setSelectedIds] = useState<string[]>([]);
   const [batchMode, setBatchMode] = useState(false);

   return (
     <>
       <Space>
         <Button
           onClick={() => setBatchMode(!batchMode)}
           icon={batchMode ? <CloseOutlined /> : <CheckSquareOutlined />}
         >
           {batchMode ? 'å–æ¶ˆæ‰¹é‡' : 'æ‰¹é‡æ“ä½œ'}
         </Button>

         {batchMode && (
           <>
             <Button
               danger
               disabled={selectedIds.length === 0}
               onClick={handleBatchDelete}
             >
               åˆ é™¤é€‰ä¸­ ({selectedIds.length})
             </Button>
             <Button
               disabled={selectedIds.length === 0}
               onClick={handleBatchExport}
             >
               å¯¼å‡ºé€‰ä¸­
             </Button>
             <Select
               placeholder="æ‰¹é‡è®¾ç½®çŠ¶æ€"
               disabled={selectedIds.length === 0}
               onChange={handleBatchUpdateStatus}
             >
               <Option value="draft">è‰ç¨¿</Option>
               <Option value="completed">å·²å®Œæˆ</Option>
             </Select>
           </>
         )}
       </Space>

       <List
         dataSource={chapters}
         renderItem={(chapter) => (
           <List.Item>
             {batchMode && (
               <Checkbox
                 checked={selectedIds.includes(chapter.id)}
                 onChange={(e) => handleSelectChange(chapter.id, e.target.checked)}
               />
             )}
             {/* åŸæœ‰å†…å®¹ */}
           </List.Item>
         )}
       />
     </>
   );
   ```

3. **æ“ä½œç¡®è®¤æç¤º**:
   ```typescript
   const handleBatchDelete = () => {
     Modal.confirm({
       title: 'ç¡®è®¤åˆ é™¤',
       content: `å³å°†åˆ é™¤ ${selectedIds.length} ä¸ªç« èŠ‚ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`,
       okText: 'ç¡®è®¤åˆ é™¤',
       okType: 'danger',
       cancelText: 'å–æ¶ˆ',
       onOk: async () => {
         await chapterApi.batchDelete(selectedIds);
         message.success('æ‰¹é‡åˆ é™¤æˆåŠŸ');
         setSelectedIds([]);
         refreshChapters();
       }
     });
   };
   ```

4. **æ”¯æŒçš„æ‰¹é‡æ“ä½œ**:
   - æ‰¹é‡åˆ é™¤ï¼ˆç« èŠ‚/è§’è‰²/å¤§çº²ï¼‰
   - æ‰¹é‡å¯¼å‡ºï¼ˆZIP æ‰“åŒ…ï¼‰
   - æ‰¹é‡ä¿®æ”¹çŠ¶æ€
   - æ‰¹é‡åº”ç”¨å†™ä½œé£æ ¼
   - æ‰¹é‡æ ‡è®°ä¸º"å·²è¯»"/"æœªè¯»"ï¼ˆç« èŠ‚ç®¡ç†ï¼‰

**ä¼˜å…ˆçº§ç†ç”±**:
- æå‡å¤§å‹é¡¹ç›®ç®¡ç†æ•ˆç‡
- å¸¸è§ç”¨æˆ·éœ€æ±‚
- å®ç°æˆæœ¬é€‚ä¸­

---

#### 7. ç« èŠ‚ç‰ˆæœ¬å†å²ç®¡ç†ç¼ºå¤±

**é—®é¢˜æè¿°**:
- ç« èŠ‚ç¼–è¾‘æ— ç‰ˆæœ¬å†å²è®°å½•
- AI é‡æ–°ç”Ÿæˆä¼šç›´æ¥è¦†ç›–åŸå†…å®¹
- æ— æ³•å›é€€åˆ°ä¹‹å‰ç‰ˆæœ¬
- æ— æ³•å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„å·®å¼‚
- è¯¯æ“ä½œæ— æ³•æ¢å¤

**æ ¹æœ¬åŸå› **:
- ç¼ºå°‘ `ChapterVersion` æ•°æ®æ¨¡å‹
- ç« èŠ‚æ›´æ–°æœªå®ç°ç‰ˆæœ¬æ§åˆ¶
- æ— ç‰ˆæœ¬ç®¡ç†ç•Œé¢

**å½±å“èŒƒå›´**:
- **å†…å®¹å®‰å…¨**: æ— æ³•æ¢å¤è¯¯æ“ä½œæˆ–è¯¯åˆ é™¤
- **å¯¹æ¯”åˆ†æ**: æ— æ³•å¯¹æ¯” AI å¤šæ¬¡ç”Ÿæˆç»“æœé€‰æ‹©æœ€ä½³
- **åˆ›ä½œè®°å½•**: æ— æ³•å›é¡¾åˆ›ä½œè¿‡ç¨‹
- **åä½œå†²çª**: å¤šäººç¼–è¾‘æ—¶æ— æ³•è¿½æº¯ä¿®æ”¹å†å²

**æ¶‰åŠæ–‡ä»¶**:
- éœ€æ–°å¢ `backend/app/models/chapter_version.py`
- éœ€ä¿®æ”¹ `backend/app/api/chapters.py` - æ›´æ–°æ—¶åˆ›å»ºç‰ˆæœ¬
- éœ€æ–°å¢å‰ç«¯ç‰ˆæœ¬ç®¡ç†ç»„ä»¶

**å»ºè®®æ–¹æ¡ˆ**:

1. **æ•°æ®æ¨¡å‹è®¾è®¡**:
   ```python
   # backend/app/models/chapter_version.py
   class ChapterVersion(Base):
       __tablename__ = "chapter_versions"

       id = Column(String(36), primary_key=True)
       chapter_id = Column(String(36), ForeignKey("chapters.id", ondelete="CASCADE"))
       version_number = Column(Integer, nullable=False)  # è‡ªå¢ç‰ˆæœ¬å·
       title = Column(String(200))
       content = Column(Text)
       word_count = Column(Integer)
       change_description = Column(String(500))  # ä¿®æ”¹è¯´æ˜
       created_by = Column(String(20))  # "user" or "ai"
       created_at = Column(DateTime, server_default=func.now())

       # ç´¢å¼•
       __table_args__ = (
           Index('idx_chapter_version', 'chapter_id', 'version_number'),
       )
   ```

2. **è‡ªåŠ¨ç‰ˆæœ¬åˆ›å»º**:
   ```python
   # backend/app/api/chapters.py
   @router.put("/{chapter_id}")
   async def update_chapter(
       chapter_id: str,
       chapter_update: ChapterUpdate,
       db: AsyncSession = Depends(get_db)
   ):
       # æ›´æ–°å‰ä¿å­˜å½“å‰ç‰ˆæœ¬
       current = await db.get(Chapter, chapter_id)

       # è®¡ç®—ç‰ˆæœ¬å·
       version_count = await db.execute(
           select(func.count(ChapterVersion.id))
           .where(ChapterVersion.chapter_id == chapter_id)
       )
       next_version = version_count.scalar() + 1

       # åˆ›å»ºç‰ˆæœ¬è®°å½•
       version = ChapterVersion(
           chapter_id=chapter_id,
           version_number=next_version,
           title=current.title,
           content=current.content,
           word_count=current.word_count,
           created_by="user"
       )
       db.add(version)

       # æ›´æ–°ç« èŠ‚
       for key, value in chapter_update.model_dump(exclude_unset=True).items():
           setattr(current, key, value)

       await db.commit()
       return current
   ```

3. **ç‰ˆæœ¬ç®¡ç† API**:
   ```python
   @router.get("/{chapter_id}/versions", summary="è·å–ç« èŠ‚ç‰ˆæœ¬å†å²")
   async def get_chapter_versions(
       chapter_id: str,
       db: AsyncSession = Depends(get_db)
   ):
       """è·å–ç« èŠ‚æ‰€æœ‰ç‰ˆæœ¬"""
       result = await db.execute(
           select(ChapterVersion)
           .where(ChapterVersion.chapter_id == chapter_id)
           .order_by(ChapterVersion.version_number.desc())
       )
       return result.scalars().all()

   @router.post("/{chapter_id}/versions/{version_id}/restore", summary="æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬")
   async def restore_chapter_version(
       chapter_id: str,
       version_id: str,
       db: AsyncSession = Depends(get_db)
   ):
       """æ¢å¤ç« èŠ‚åˆ°æŒ‡å®šç‰ˆæœ¬"""
       version = await db.get(ChapterVersion, version_id)
       chapter = await db.get(Chapter, chapter_id)

       # å…ˆä¿å­˜å½“å‰å†…å®¹ä¸ºæ–°ç‰ˆæœ¬ï¼ˆæ¢å¤å‰çš„å¿«ç…§ï¼‰
       # ...

       # æ¢å¤å†…å®¹
       chapter.title = version.title
       chapter.content = version.content
       chapter.word_count = version.word_count

       await db.commit()
       return chapter

   @router.get("/{chapter_id}/versions/compare", summary="ç‰ˆæœ¬å¯¹æ¯”")
   async def compare_versions(
       chapter_id: str,
       version1: int,
       version2: int,
       db: AsyncSession = Depends(get_db)
   ):
       """å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚"""
       # ä½¿ç”¨ difflib å®ç°æ–‡æœ¬ diff
       import difflib

       v1 = await db.execute(...)
       v2 = await db.execute(...)

       diff = difflib.unified_diff(
           v1.content.splitlines(),
           v2.content.splitlines(),
           lineterm=''
       )
       return {"diff": list(diff)}
   ```

4. **å‰ç«¯ç‰ˆæœ¬æ—¶é—´çº¿ UI**:
   ```typescript
   // frontend/src/components/ChapterVersionHistory.tsx
   const ChapterVersionHistory = ({ chapterId }) => {
     const [versions, setVersions] = useState([]);

     return (
       <Timeline>
         {versions.map(version => (
           <Timeline.Item key={version.id}>
             <Space direction="vertical">
               <Text strong>ç‰ˆæœ¬ {version.version_number}</Text>
               <Text type="secondary">
                 {format(version.created_at, 'yyyy-MM-dd HH:mm')}
               </Text>
               <Text>{version.change_description}</Text>
               <Space>
                 <Button size="small" onClick={() => handleRestore(version.id)}>
                   æ¢å¤æ­¤ç‰ˆæœ¬
                 </Button>
                 <Button size="small" onClick={() => handleCompare(version.id)}>
                   å¯¹æ¯”å·®å¼‚
                 </Button>
               </Space>
             </Space>
           </Timeline.Item>
         ))}
       </Timeline>
     );
   };
   ```

5. **ç‰ˆæœ¬ç®¡ç†ç­–ç•¥**:
   - è‡ªåŠ¨ä¿å­˜ç‰ˆæœ¬ï¼ˆæ¯æ¬¡ç¼–è¾‘æˆ– AI ç”Ÿæˆï¼‰
   - ç‰ˆæœ¬ä¿ç•™ç­–ç•¥ï¼š
     - æœ€è¿‘ 10 ä¸ªç‰ˆæœ¬ï¼šå…¨éƒ¨ä¿ç•™
     - 10-30 ä¸ªç‰ˆæœ¬ï¼šæ¯ 3 ä¸ªä¿ç•™ 1 ä¸ª
     - 30 ä¸ªä»¥ä¸Šï¼šæ¯ 10 ä¸ªä¿ç•™ 1 ä¸ª
   - é‡è¦ç‰ˆæœ¬æ ‡è®°ï¼ˆç”¨æˆ·å¯æ‰‹åŠ¨æ ‡è®°ä¸º"é‡Œç¨‹ç¢‘"ï¼‰

**ä¼˜å…ˆçº§ç†ç”±**:
- æå‡å†…å®¹å®‰å…¨æ€§
- å…è®¸ AI å®éªŒï¼ˆå¯æ¢å¤ï¼‰
- å¸¸è§éœ€æ±‚ï¼Œç”¨æˆ·ä»·å€¼é«˜

---

### ğŸŸ¡ ä½ä¼˜å…ˆçº§ï¼ˆP2ï¼‰- é”¦ä¸Šæ·»èŠ±åŠŸèƒ½

#### 8. è®¾å®šè¿½æº¯ä¸çŸ›ç›¾æ£€æµ‹ï¼ˆREADME TODOï¼‰

**é—®é¢˜æè¿°**:
- æ— æ³•è‡ªåŠ¨æ£€æµ‹ç« èŠ‚å†…å®¹ä¸å·²æœ‰è®¾å®šçš„çŸ›ç›¾ï¼ˆåƒä¹¦ï¼‰
- ç¼ºå°‘è®¾å®šæ¥æºæ ‡æ³¨ï¼ˆè§’è‰²å±æ€§åœ¨å“ªç« æåŠï¼‰
- é•¿ç¯‡å°è¯´å®¹æ˜“å‡ºç°å‰åçŸ›ç›¾
- æ— æ™ºèƒ½æé†’æœºåˆ¶

**æ ¹æœ¬åŸå› **:
- éœ€è¦å¤æ‚çš„ NLP å’Œé€»è¾‘æ¨ç†
- RAG è®°å¿†ç³»ç»Ÿå·²éƒ¨åˆ†å®ç°è¿½æº¯èƒ½åŠ›
- ç¼ºå°‘è§„åˆ™å¼•æ“å’Œå†²çªæ£€æµ‹ç®—æ³•

**å½±å“èŒƒå›´**:
- **å†…å®¹è´¨é‡**: é•¿ç¯‡å°è¯´ï¼ˆ100+ç« ï¼‰æ˜“å‡ºç°è®¾å®šçŸ›ç›¾
- **è¯»è€…ä½“éªŒ**: çŸ›ç›¾å½±å“ä½œå“å£ç¢‘

**å»ºè®®æ–¹æ¡ˆ**:

1. **åŸºäº RAG çš„è¿½æº¯ç³»ç»Ÿ**:
   - æå–å…³é”®è®¾å®šï¼ˆäººç‰©å±æ€§ã€æ—¶é—´çº¿ã€åœ°ç‚¹æè¿°ï¼‰
   - å»ºç«‹è®¾å®šç´¢å¼•ï¼ˆç« èŠ‚ -> è®¾å®šåˆ—è¡¨ï¼‰
   - è¯­ä¹‰æœç´¢ç›¸å…³ç« èŠ‚

2. **å…³é”®è¯å¯¹æ¯”æ£€æµ‹**:
   ```python
   # æ£€æµ‹è§„åˆ™ç¤ºä¾‹
   rules = {
       "character_age": r"(\w+).*?(\d+)å²",
       "character_gender": r"(\w+).*(ç”·|å¥³)",
       "location": r"(åœ¨|æ¥åˆ°|å‰å¾€)([^\sï¼Œã€‚]+)"
   }

   # å¯¹æ¯”æ–°ç« èŠ‚ä¸å†å²è®¾å®š
   conflicts = []
   for entity, pattern in rules.items():
       new_matches = extract(new_chapter.content, pattern)
       history_matches = extract(history_chapters, pattern)
       conflicts.extend(find_conflicts(new_matches, history_matches))
   ```

3. **AI è¾…åŠ©æ£€æµ‹**:
   - è°ƒç”¨ AI åˆ†æç« èŠ‚å†…å®¹
   - æä¾›ä¸Šä¸‹æ–‡ï¼ˆç›¸å…³ç« èŠ‚ç‰‡æ®µï¼‰
   - AI åˆ¤æ–­æ˜¯å¦å­˜åœ¨çŸ›ç›¾å¹¶ç»™å‡ºå»ºè®®

4. **å†²çªæŠ¥å‘Šç•Œé¢**:
   ```
   âš ï¸ å‘ç°æ½œåœ¨çŸ›ç›¾ï¼š

   è§’è‰²"ææ˜"çš„å¹´é¾„ä¸ä¸€è‡´ï¼š
   - ç¬¬3ç« ï¼šææ˜ä»Šå¹´18å²
   - ç¬¬45ç« ï¼šææ˜ä»Šå¹´22å²ï¼ˆæ—¶é—´è·¨åº¦ä»…1å¹´ï¼‰

   å»ºè®®ï¼š
   1. ä¿®æ”¹ç¬¬45ç« ä¸º"19å²"
   2. è°ƒæ•´æ—¶é—´çº¿è·¨åº¦
   3. æ ‡è®°ä¸º"è®¾å®šå˜æ›´"å¹¶æ·»åŠ è¯´æ˜
   ```

**ä¼˜å…ˆçº§ç†ç”±**:
- æŠ€æœ¯å¤æ‚åº¦æé«˜
- éœ€è¦å¤§é‡è§„åˆ™å’Œæ•°æ®è®­ç»ƒ
- å¯ä½œä¸ºé«˜çº§ä»˜è´¹åŠŸèƒ½

---

#### 9. æ€ç»´é“¾ä¸ç« èŠ‚å…³ç³»å›¾è°±ï¼ˆREADME TODOï¼‰

**é—®é¢˜æè¿°**:
- æ— ç« èŠ‚å…³ç³»å¯è§†åŒ–
- ç¼ºå°‘ä¼ç¬”-æ­æ™“æ˜ å°„
- æ— æ³•ç›´è§‚æŸ¥çœ‹æ•…äº‹ç»“æ„
- æ˜æš—çº¿ç´¢è¿½è¸ªå›°éš¾

**æ ¹æœ¬åŸå› **:
- éœ€è¦å›¾è°±å¯è§†åŒ–ç»„ä»¶ï¼ˆECharts/D3.js/G6ï¼‰
- åç«¯éœ€å®ç°å…³ç³»æŠ½å–å’Œå›¾æ•°æ®å­˜å‚¨
- ç« èŠ‚å…³ç³»éœ€è¦ AI åˆ†ææå–

**å½±å“èŒƒå›´**:
- **ç»“æ„åˆ†æ**: ç¼ºå°‘å®è§‚è§†è§’
- **åˆ›ä½œè§„åˆ’**: æ— æ³•é¢„è§ˆæ•…äº‹èµ°å‘

**å»ºè®®æ–¹æ¡ˆ**:

1. **å…³ç³»å›¾è°±æ•°æ®æ¨¡å‹**:
   ```python
   # backend/app/models/chapter_relation.py
   class ChapterRelation(Base):
       __tablename__ = "chapter_relations"

       id = Column(String(36), primary_key=True)
       project_id = Column(String(36), ForeignKey("projects.id"))
       from_chapter_id = Column(String(36), ForeignKey("chapters.id"))
       to_chapter_id = Column(String(36), ForeignKey("chapters.id"))
       relation_type = Column(String(50))  # foreshadow/callback/parallel
       description = Column(Text)  # å…³ç³»æè¿°
       confidence = Column(Float)  # AI åˆ†æçš„ç½®ä¿¡åº¦
       created_at = Column(DateTime)
   ```

2. **AI å…³ç³»æå–**:
   ```python
   # ä½¿ç”¨ AI åˆ†æç« èŠ‚å…³ç³»
   prompt = f"""
   åˆ†æä»¥ä¸‹ä¸¤ä¸ªç« èŠ‚ä¹‹é—´çš„å…³ç³»ï¼š

   ç¬¬{from_chapter.chapter_number}ç« : {from_chapter.summary}
   ç¬¬{to_chapter.chapter_number}ç« : {to_chapter.summary}

   è¯·è¯†åˆ«ï¼š
   1. æ˜¯å¦å­˜åœ¨ä¼ç¬”ä¸æ­æ™“å…³ç³»
   2. æ˜¯å¦å­˜åœ¨æƒ…èŠ‚å‘¼åº”
   3. æ˜¯å¦å­˜åœ¨å¹¶è¡Œå™äº‹

   è¿”å›JSONæ ¼å¼...
   """
   ```

3. **å‰ç«¯å›¾è°±å¯è§†åŒ–**:
   ```typescript
   // ä½¿ç”¨ AntV G6 æˆ– ECharts Graph
   import { Graph } from '@antv/g6';

   const ChapterGraphView = ({ projectId }) => {
     const graph = new Graph({
       container: 'graph-container',
       data: {
         nodes: chapters.map(c => ({
           id: c.id,
           label: `ç¬¬${c.chapter_number}ç« `,
           type: 'circle'
         })),
         edges: relations.map(r => ({
           source: r.from_chapter_id,
           target: r.to_chapter_id,
           label: r.relation_type,
           style: { stroke: getColorByType(r.relation_type) }
         }))
       },
       layout: { type: 'force' }
     });

     return <div id="graph-container" style={{ width: '100%', height: 600 }} />;
   };
   ```

4. **å…³ç³»ç±»å‹å®šä¹‰**:
   - **ä¼ç¬”-æ­æ™“** (foreshadow): ç¬¬5ç« åŸ‹ä¸‹ä¼ç¬”ï¼Œç¬¬20ç« æ­æ™“
   - **å› æœå…³ç³»** (causality): ç¬¬3ç« äº‹ä»¶å¯¼è‡´ç¬¬10ç« ç»“æœ
   - **å¹¶è¡Œå™äº‹** (parallel): ç¬¬2ç« å’Œç¬¬7ç« åŒæ—¶å‘ç”Ÿ
   - **å›å¿†/é—ªå›** (flashback): ç¬¬15ç« å›å¿†ç¬¬1ç« åœºæ™¯
   - **è§’è‰²çº¿ç´¢** (character_thread): è¿½è¸ªè§’è‰²å‡ºåœºç« èŠ‚

**ä¼˜å…ˆçº§ç†ç”±**:
- è§†è§‰åŒ–éœ€æ±‚ï¼Œéæ ¸å¿ƒåŠŸèƒ½
- æŠ€æœ¯å®ç°å¤æ‚
- é€‚åˆä½œä¸ºé«˜çº§åŠŸèƒ½

---

#### 10. é¡¹ç›®æ¨¡æ¿ç³»ç»Ÿ

**é—®é¢˜æè¿°**:
- æ¯æ¬¡åˆ›å»ºé¡¹ç›®éƒ½è¦é‡æ–°é…ç½®å‚æ•°
- æ— æ³•ä¿å­˜å¸¸ç”¨è®¾å®šï¼ˆç±»å‹ã€é£æ ¼ã€è§’è‰²æ¨¡æ¿ï¼‰
- é‡å¤é…ç½®é™ä½æ•ˆç‡
- æ— æ³•å¿«é€Ÿå¯åŠ¨åŒç±»å‹é¡¹ç›®

**æ ¹æœ¬åŸå› **:
- æœªå®ç°æ¨¡æ¿æœºåˆ¶
- ç¼ºå°‘æ¨¡æ¿å­˜å‚¨å’Œåº”ç”¨é€»è¾‘

**å½±å“èŒƒå›´**:
- **åˆ›ä½œæ•ˆç‡**: ç†Ÿç»ƒç”¨æˆ·é‡å¤é…ç½®è€—æ—¶
- **å¿«é€Ÿå¼€å§‹**: æ–°ç”¨æˆ·ç¼ºå°‘å‚è€ƒæ¨¡æ¿

**å»ºè®®æ–¹æ¡ˆ**:

1. **æ¨¡æ¿æ•°æ®æ¨¡å‹**:
   ```python
   # backend/app/models/project_template.py
   class ProjectTemplate(Base):
       __tablename__ = "project_templates"

       id = Column(String(36), primary_key=True)
       name = Column(String(100), nullable=False)
       description = Column(String(500))
       category = Column(String(50))  # fantasy/modern/scifi/romance
       is_system = Column(Boolean, default=False)  # ç³»ç»Ÿé¢„è®¾
       is_public = Column(Boolean, default=False)  # å…¬å¼€å…±äº«

       # æ¨¡æ¿é…ç½®ï¼ˆJSONï¼‰
       config = Column(JSON)  # {genre, theme, chapter_count, narrative_perspective...}

       # é¢„è®¾å†…å®¹
       default_writing_style_id = Column(String(36))
       world_building_template = Column(Text)  # ä¸–ç•Œè§‚æ¨¡æ¿
       character_templates = Column(JSON)  # è§’è‰²æ¨¡æ¿åˆ—è¡¨
       outline_template = Column(Text)  # å¤§çº²æ¨¡æ¿

       created_by = Column(String(100))
       created_at = Column(DateTime)
   ```

2. **æ¨¡æ¿ç®¡ç† API**:
   ```python
   @router.post("/templates", summary="åˆ›å»ºé¡¹ç›®æ¨¡æ¿")
   async def create_template(
       template: ProjectTemplateCreate,
       request: Request,
       db: AsyncSession = Depends(get_db)
   ):
       """ä»ç°æœ‰é¡¹ç›®åˆ›å»ºæ¨¡æ¿"""
       # å®ç°é€»è¾‘...

   @router.get("/templates", summary="è·å–æ¨¡æ¿åˆ—è¡¨")
   async def get_templates(
       category: Optional[str] = None,
       db: AsyncSession = Depends(get_db)
   ):
       """è·å–å¯ç”¨æ¨¡æ¿"""
       # å®ç°é€»è¾‘...

   @router.post("/projects/from-template", summary="åŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®")
   async def create_project_from_template(
       template_id: str,
       overrides: dict,  # è¦†ç›–éƒ¨åˆ†é…ç½®
       db: AsyncSession = Depends(get_db)
   ):
       """åŸºäºæ¨¡æ¿å¿«é€Ÿåˆ›å»ºé¡¹ç›®"""
       # å®ç°é€»è¾‘...
   ```

3. **ç³»ç»Ÿé¢„è®¾æ¨¡æ¿**:
   - **ç„å¹»ä¿®ä»™**: 30ç« ï¼Œç¬¬ä¸‰äººç§°ï¼Œ5è§’è‰²ï¼Œä»™ä¾ é£æ ¼
   - **ç°ä»£éƒ½å¸‚**: 50ç« ï¼Œç¬¬ä¸€äººç§°ï¼Œ3è§’è‰²ï¼Œç°ä»£é£æ ¼
   - **ç§‘å¹»æœªæ¥**: 40ç« ï¼Œç¬¬ä¸‰äººç§°ï¼Œ7è§’è‰²ï¼Œç§‘å¹»é£æ ¼
   - **æ‚¬ç–‘æ¨ç†**: 20ç« ï¼Œç¬¬ä¸€äººç§°ï¼Œ5è§’è‰²ï¼Œæ‚¬ç–‘é£æ ¼
   - **çŸ­ç¯‡å°è¯´**: 3ç« ï¼Œçµæ´»è§†è§’ï¼Œ2è§’è‰²ï¼Œç®€æ´é£æ ¼

4. **å‰ç«¯æ¨¡æ¿é€‰æ‹©ç•Œé¢**:
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ é€‰æ‹©é¡¹ç›®æ¨¡æ¿                        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ [ç³»ç»Ÿæ¨¡æ¿] [æˆ‘çš„æ¨¡æ¿] [ç¤¾åŒºæ¨¡æ¿]   â”‚
   â”‚                                     â”‚
   â”‚ â”Œâ”€ ç„å¹»ä¿®ä»™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
   â”‚ â”‚ 30ç«  | ç¬¬ä¸‰äººç§° | 5è§’è‰²    â”‚     â”‚
   â”‚ â”‚ [ä½¿ç”¨æ­¤æ¨¡æ¿] [é¢„è§ˆ]        â”‚     â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚                                     â”‚
   â”‚ â”Œâ”€ ç°ä»£éƒ½å¸‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
   â”‚ â”‚ 50ç«  | ç¬¬ä¸€äººç§° | 3è§’è‰²    â”‚     â”‚
   â”‚ â”‚ [ä½¿ç”¨æ­¤æ¨¡æ¿] [é¢„è§ˆ]        â”‚     â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚                                     â”‚
   â”‚ [ä»ç©ºç™½é¡¹ç›®å¼€å§‹]                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

5. **æ¨¡æ¿åº”ç”¨æµç¨‹**:
   - é€‰æ‹©æ¨¡æ¿ -> é¢„è§ˆé…ç½® -> å¯é€‰ä¿®æ”¹å‚æ•° -> ä¸€é”®åˆ›å»ºé¡¹ç›®
   - è‡ªåŠ¨å¡«å……ï¼šç±»å‹ã€ä¸»é¢˜ã€ç« èŠ‚æ•°ã€å†™ä½œé£æ ¼
   - å¯é€‰é¢„å¡«å……ï¼šä¸–ç•Œè§‚æ¨¡æ¿ã€è§’è‰²æ¨¡æ¿ã€å¤§çº²æ¡†æ¶

**ä¼˜å…ˆçº§ç†ç”±**:
- æå‡ç†Ÿç»ƒç”¨æˆ·æ•ˆç‡
- é™ä½æ–°ç”¨æˆ·ä¸Šæ‰‹éš¾åº¦
- å®ç°æˆæœ¬é€‚ä¸­

---

#### 11. åˆ›ä½œç»Ÿè®¡ä¸åˆ†æ

**é—®é¢˜æè¿°**:
- æ— å†™ä½œç»Ÿè®¡æ•°æ®ï¼ˆæ—¥äº§é‡ã€å‘¨è¿›åº¦ã€æœˆæ€»ç»“ï¼‰
- ç¼ºå°‘æ•°æ®å¯è§†åŒ–ï¼ˆæŠ˜çº¿å›¾ã€çƒ­å›¾ï¼‰
- æ— æ³•é‡åŒ–åˆ›ä½œæˆæœ
- ç¼ºå°‘æ¿€åŠ±æœºåˆ¶

**æ ¹æœ¬åŸå› **:
- æœªè®°å½•å†™ä½œè¡Œä¸ºæ•°æ®
- ç¼ºå°‘ç»Ÿè®¡åˆ†ææ¨¡å—
- æ— å¯è§†åŒ–ç»„ä»¶

**å½±å“èŒƒå›´**:
- **ç”¨æˆ·æ¿€åŠ±**: æ— æ³•é‡åŒ–æˆå°±æ„Ÿ
- **ä¹ æƒ¯å…»æˆ**: ç¼ºå°‘æ•°æ®åé¦ˆ

**å»ºè®®æ–¹æ¡ˆ**:

1. **ç»Ÿè®¡æ•°æ®æ¨¡å‹**:
   ```python
   # backend/app/models/writing_stats.py
   class WritingStats(Base):
       __tablename__ = "writing_stats"

       id = Column(String(36), primary_key=True)
       user_id = Column(String(100), nullable=False)
       project_id = Column(String(36))
       date = Column(Date, nullable=False)

       # ç»Ÿè®¡æŒ‡æ ‡
       words_written = Column(Integer, default=0)  # æ–°å¢å­—æ•°
       words_edited = Column(Integer, default=0)  # ç¼–è¾‘å­—æ•°
       editing_time = Column(Integer, default=0)  # ç¼–è¾‘æ—¶é•¿(ç§’)
       chapters_created = Column(Integer, default=0)
       chapters_completed = Column(Integer, default=0)

       # ç´¢å¼•
       __table_args__ = (
           Index('idx_user_date', 'user_id', 'date'),
       )
   ```

2. **ç»Ÿè®¡ API**:
   ```python
   @router.get("/stats/summary", summary="è·å–ç»Ÿè®¡æ‘˜è¦")
   async def get_stats_summary(
       period: str = "week",  # day/week/month/year
       request: Request,
       db: AsyncSession = Depends(get_db)
   ):
       """è·å–ç»Ÿè®¡æ•°æ®"""
       user_id = request.state.user_id

       # è®¡ç®—æ—¥æœŸèŒƒå›´
       end_date = date.today()
       if period == "week":
           start_date = end_date - timedelta(days=7)
       elif period == "month":
           start_date = end_date - timedelta(days=30)

       # æŸ¥è¯¢ç»Ÿè®¡
       result = await db.execute(
           select(WritingStats)
           .where(WritingStats.user_id == user_id)
           .where(WritingStats.date >= start_date)
           .order_by(WritingStats.date)
       )

       return {
           "total_words": sum(s.words_written for s in stats),
           "daily_stats": stats,
           "streak_days": calculate_streak(stats)
       }
   ```

3. **å‰ç«¯ç»Ÿè®¡ç•Œé¢**:
   ```typescript
   // frontend/src/pages/WritingStats.tsx
   const WritingStats = () => {
     const [period, setPeriod] = useState('week');
     const [stats, setStats] = useState(null);

     return (
       <Card title="åˆ›ä½œç»Ÿè®¡">
         <Row gutter={16}>
           <Col span={6}>
             <Statistic
               title="æœ¬å‘¨å­—æ•°"
               value={stats?.total_words}
               suffix="å­—"
             />
           </Col>
           <Col span={6}>
             <Statistic
               title="è¿ç»­åˆ›ä½œ"
               value={stats?.streak_days}
               suffix="å¤©"
             />
           </Col>
           <Col span={6}>
             <Statistic
               title="å®Œæˆç« èŠ‚"
               value={stats?.chapters_completed}
               suffix="ç« "
             />
           </Col>
           <Col span={6}>
             <Statistic
               title="åˆ›ä½œæ—¶é•¿"
               value={formatTime(stats?.editing_time)}
             />
           </Col>
         </Row>

         {/* æŠ˜çº¿å›¾ï¼šæ¯æ—¥å­—æ•° */}
         <Line data={stats?.daily_stats} xField="date" yField="words_written" />

         {/* æ—¥å†çƒ­å›¾ï¼šåˆ›ä½œæ´»è·ƒåº¦ */}
         <CalendarHeatmap data={stats?.daily_stats} />
       </Card>
     );
   };
   ```

4. **æˆå°±ç³»ç»Ÿ**:
   - **é‡Œç¨‹ç¢‘å¾½ç« **:
     - é¦–æ¬¡å®Œæˆ1ä¸‡å­— ğŸ†
     - è¿ç»­åˆ›ä½œ7å¤© ğŸ”¥
     - å®Œæˆé¦–ä¸ªé¡¹ç›® ğŸ‰
     - ç´¯è®¡åˆ›ä½œ10ä¸‡å­— ğŸ’
   - **ç­‰çº§ç³»ç»Ÿ**: æ ¹æ®ç´¯è®¡å­—æ•°å‡çº§ï¼ˆé’é“œ/ç™½é“¶/é»„é‡‘/é’»çŸ³ï¼‰

**ä¼˜å…ˆçº§ç†ç”±**:
- å¢å¼ºç”¨æˆ·ç²˜æ€§
- æ¸¸æˆåŒ–æ¿€åŠ±
- éæ ¸å¿ƒåŠŸèƒ½

---

#### 12. å¤šäººåä½œåŠŸèƒ½

**é—®é¢˜æè¿°**:
- ä¸æ”¯æŒå¤šäººååŒç¼–è¾‘
- æ— æƒé™ç®¡ç†ï¼ˆåªè¯»/ç¼–è¾‘/ç®¡ç†å‘˜ï¼‰
- æ— å®æ—¶åŒæ­¥
- ä¸é€‚åˆå›¢é˜Ÿåˆ›ä½œåœºæ™¯

**æ ¹æœ¬åŸå› **:
- äº§å“å®šä½ä¸ºä¸ªäººå·¥å…·
- åä½œéœ€è¦å¤æ‚çš„å†²çªè§£å†³æœºåˆ¶ï¼ˆOT/CRDTï¼‰
- éœ€è¦ WebSocket å®æ—¶é€šä¿¡

**å½±å“èŒƒå›´**:
- **å›¢é˜Ÿåˆ›ä½œ**: ç¼–å‰§å›¢é˜Ÿã€è”åˆåˆ›ä½œæ— æ³•ä½¿ç”¨
- **å¤šè®¾å¤‡åŒæ­¥**: ä¸ªäººå¤šè®¾å¤‡åˆ‡æ¢ä¸ä¾¿

**å»ºè®®æ–¹æ¡ˆ**:

1. **æƒé™ç®¡ç†æ¨¡å‹**:
   ```python
   # backend/app/models/project_member.py
   class ProjectMember(Base):
       __tablename__ = "project_members"

       id = Column(String(36), primary_key=True)
       project_id = Column(String(36), ForeignKey("projects.id"))
       user_id = Column(String(100), nullable=False)
       role = Column(String(20))  # owner/editor/viewer
       permissions = Column(JSON)  # ç»†ç²’åº¦æƒé™
       invited_by = Column(String(100))
       joined_at = Column(DateTime)
   ```

2. **å®æ—¶åä½œæ¶æ„**:
   - WebSocket è¿æ¥ç®¡ç†
   - æ“ä½œè½¬æ¢ç®—æ³•ï¼ˆOTï¼‰æˆ– CRDT
   - å†²çªæ£€æµ‹å’Œè‡ªåŠ¨åˆå¹¶
   - å…‰æ ‡ä½ç½®åŒæ­¥

3. **åä½œåŠŸèƒ½**:
   - å®æ—¶ç¼–è¾‘åŒæ­¥
   - åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
   - è¯„è®ºå’Œæ‰¹æ³¨
   - ä¿®æ”¹å†å²è¿½è¸ª
   - ä»»åŠ¡åˆ†é…ï¼ˆç« èŠ‚åˆ†é…ç»™ä¸åŒæˆå‘˜ï¼‰

4. **æƒé™æ§åˆ¶**:
   - **Owner**: å…¨éƒ¨æƒé™
   - **Editor**: ç¼–è¾‘å†…å®¹ã€åˆ›å»ºç« èŠ‚
   - **Viewer**: åªè¯»ï¼Œå¯è¯„è®º
   - **ç»†ç²’åº¦æƒé™**: å¯å•ç‹¬æ§åˆ¶ç« èŠ‚/è§’è‰²/å¤§çº²çš„è®¿é—®æƒé™

**ä¼˜å…ˆçº§ç†ç”±**:
- æ¶æ„æ”¹åŠ¨æå¤§
- æŠ€æœ¯å¤æ‚åº¦é«˜
- é€‚åˆ 2.0 ç‰ˆæœ¬ç‹¬ç«‹æ¨¡å—
- éœ€æ±‚éªŒè¯ä¸è¶³

---

## å››ã€åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ

| åŠŸèƒ½åç§° | å½±å“èŒƒå›´ | å®ç°éš¾åº¦ | ç”¨æˆ·ä»·å€¼ | ç»¼åˆä¼˜å…ˆçº§ |
|---------|---------|---------|---------|-----------|
| çŸ­ç¯‡å°è¯´æ”¯æŒ | â­â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­â­ | **P0** |
| ç« èŠ‚è‡ªåŠ¨ä¿å­˜ | â­â­â­â­â­ | ğŸ”§ğŸ”§ | â­â­â­â­â­ | **P0** |
| å…¨å±€æœç´¢ | â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­ | **P0** |
| çµæ„Ÿæ¨¡å¼ | â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­ | P1 |
| Promptç¼–è¾‘ç•Œé¢ | â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­ | P1 |
| æ‰¹é‡æ“ä½œ | â­â­â­ | ğŸ”§ğŸ”§ | â­â­â­ | P1 |
| ç‰ˆæœ¬å†å²ç®¡ç† | â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­ | P1 |
| è®¾å®šçŸ›ç›¾æ£€æµ‹ | â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ğŸ”§ğŸ”§ | â­â­â­ | P2 |
| ç« èŠ‚å…³ç³»å›¾è°± | â­â­ | ğŸ”§ğŸ”§ğŸ”§ğŸ”§ | â­â­â­ | P2 |
| é¡¹ç›®æ¨¡æ¿ç³»ç»Ÿ | â­â­â­ | ğŸ”§ğŸ”§ | â­â­â­ | P2 |
| åˆ›ä½œç»Ÿè®¡åˆ†æ | â­â­ | ğŸ”§ğŸ”§ğŸ”§ | â­â­ | P2 |
| å¤šäººåä½œ | â­â­â­â­â­ | ğŸ”§ğŸ”§ğŸ”§ğŸ”§ğŸ”§ | â­â­â­â­ | P2 (2.0) |

**å›¾ä¾‹è¯´æ˜**:
- â­ å½±å“èŒƒå›´ï¼šæ˜Ÿçº§è¶Šé«˜å½±å“è¶Šå¤§
- ğŸ”§ å®ç°éš¾åº¦ï¼šæ‰³æ‰‹è¶Šå¤šéš¾åº¦è¶Šé«˜
- P0: é«˜ä¼˜å…ˆçº§ï¼ˆ1-2å‘¨å†…å®ç°ï¼‰
- P1: ä¸­ä¼˜å…ˆçº§ï¼ˆ1-2æœˆå†…è§„åˆ’ï¼‰
- P2: ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’/2.0ç‰ˆæœ¬ï¼‰

---

## äº”ã€å·²çŸ¥é—®é¢˜ä¸æ”¹è¿›å»ºè®®ï¼ˆåŸºäº CLAUDE.mdï¼‰

### âœ… å·²è§£å†³é—®é¢˜

1. **æ•°æ®å¯¼å…¥å¯¼å‡º** - âœ… **å·²å®Œæˆ**
   - JSON æ ¼å¼å¯¼å…¥å¯¼å‡ºï¼ˆ`backend/app/api/projects.py:427-574`ï¼‰
   - æ–‡ä»¶éªŒè¯åŠŸèƒ½ï¼ˆ`validate_import_file`ï¼‰
   - æ”¯æŒé€‰é¡¹ï¼šåŒ…å«å†™ä½œé£æ ¼ã€ç”Ÿæˆå†å²

2. **è‡ªå®šä¹‰å†™ä½œé£æ ¼** - âœ… **å·²å®Œæˆ**
   - 6ç§é¢„è®¾é£æ ¼ + è‡ªå®šä¹‰é£æ ¼ï¼ˆ`backend/app/services/prompt_service.py`ï¼‰
   - é¡¹ç›®é»˜è®¤é£æ ¼è®¾ç½®
   - é£æ ¼åº”ç”¨äºç”Ÿæˆä»»åŠ¡

3. **ç« èŠ‚å­—æ•°é™åˆ¶** - âœ… **å·²å®Œæˆ**
   - ç”¨æˆ·å¯è‡ªå®šä¹‰ç”Ÿæˆå­—æ•°ï¼ˆ`frontend/src/pages/Chapters.tsx:26`ï¼‰
   - é»˜è®¤ 3000 å­—å¯è°ƒæ•´

### âš ï¸ å¾…æ”¹è¿›é—®é¢˜

#### 1. SQLite å¹¶å‘æ€§èƒ½é™åˆ¶

**é—®é¢˜æè¿°**:
- SQLite åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å­˜åœ¨å†™é”ç­‰å¾…
- å¤šç”¨æˆ·åŒæ—¶ç”Ÿæˆç« èŠ‚å¯èƒ½å‡ºç° `database is locked` é”™è¯¯

**å½±å“èŒƒå›´**:
- ç”Ÿäº§ç¯å¢ƒé«˜å¹¶å‘åœºæ™¯
- å¤šç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€é¡¹ç›®

**å»ºè®®æ–¹æ¡ˆ**:
- çŸ­æœŸï¼šå¢åŠ  `timeout` å’Œé‡è¯•æœºåˆ¶
- é•¿æœŸï¼šæä¾› PostgreSQL é…ç½®é€‰é¡¹ï¼ˆä¿®æ”¹ `backend/app/database.py`ï¼‰
- å‚è€ƒé…ç½®ï¼š
  ```python
  # .env
  DATABASE_TYPE=postgresql  # sqlite/postgresql
  DATABASE_URL=postgresql+asyncpg://user:pass@localhost/mumuai
  ```

---

#### 2. Alembic æ•°æ®åº“è¿ç§»ç¼ºå¤±

**é—®é¢˜æè¿°**:
- æœªé›†æˆ Alembic è¿›è¡Œç‰ˆæœ¬åŒ–è¿ç§»
- æ•°æ®åº“ç»“æ„å˜æ›´éœ€æ‰‹åŠ¨å¤„ç†ï¼ˆåˆ é™¤ .db æ–‡ä»¶é‡å»ºï¼‰
- ç”Ÿäº§ç¯å¢ƒæ— æ³•å¹³æ»‘å‡çº§

**å½±å“èŒƒå›´**:
- ç‰ˆæœ¬å‡çº§æ—¶æ•°æ®ä¸¢å¤±é£é™©
- æ— æ³•å›æ»šæ•°æ®åº“å˜æ›´

**å»ºè®®æ–¹æ¡ˆ**:
1. é›†æˆ Alembic:
   ```bash
   # åˆå§‹åŒ–
   alembic init alembic

   # ç”Ÿæˆè¿ç§»è„šæœ¬
   alembic revision --autogenerate -m "add project_type field"

   # æ‰§è¡Œè¿ç§»
   alembic upgrade head
   ```

2. åœ¨ `backend/app/main.py` å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œè¿ç§»:
   ```python
   from alembic import command
   from alembic.config import Config

   @app.on_event("startup")
   async def run_migrations():
       alembic_cfg = Config("alembic.ini")
       command.upgrade(alembic_cfg, "head")
   ```

---

#### 3. å•å…ƒæµ‹è¯•ç¼ºå¤±

**é—®é¢˜æè¿°**:
- é¡¹ç›®æœªåŒ…å«å•å…ƒæµ‹è¯•
- ä»£ç è´¨é‡ä¿éšœä¸è¶³
- é‡æ„æ—¶ç¼ºå°‘å›å½’æµ‹è¯•

**å½±å“èŒƒå›´**:
- ä»£ç è´¨é‡
- ç»´æŠ¤æˆæœ¬
- Bug å‘ç°å»¶è¿Ÿ

**å»ºè®®æ–¹æ¡ˆ**:
1. åç«¯æµ‹è¯•ï¼ˆpytest + pytest-asyncioï¼‰:
   ```python
   # tests/test_projects.py
   import pytest
   from httpx import AsyncClient
   from app.main import app

   @pytest.mark.asyncio
   async def test_create_project():
       async with AsyncClient(app=app, base_url="http://test") as ac:
           response = await ac.post("/api/projects", json={
               "title": "æµ‹è¯•é¡¹ç›®",
               "theme": "ç§‘å¹»",
               "genre": "ç§‘å¹»"
           })
       assert response.status_code == 200
       assert response.json()["title"] == "æµ‹è¯•é¡¹ç›®"
   ```

2. å‰ç«¯æµ‹è¯•ï¼ˆVitest + React Testing Libraryï¼‰:
   ```typescript
   // src/pages/__tests__/Chapters.test.tsx
   import { render, screen } from '@testing-library/react';
   import Chapters from '../Chapters';

   test('renders chapter list', () => {
     render(<Chapters />);
     expect(screen.getByText(/ç« èŠ‚ç®¡ç†/i)).toBeInTheDocument();
   });
   ```

3. æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š
   - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘: 80%+
   - API ç«¯ç‚¹: 70%+
   - å‰ç«¯ç»„ä»¶: 60%+

---

## å…­ã€å®æ–½è·¯çº¿å›¾å»ºè®®

### Phase 1: ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼ŒP0 ä¼˜å…ˆçº§ï¼‰

**ç›®æ ‡**: è§£å†³æ ¸å¿ƒç—›ç‚¹ï¼Œæå‡æ—¥å¸¸ä½¿ç”¨ä½“éªŒ

#### 1.1 ç« èŠ‚è‡ªåŠ¨ä¿å­˜ï¼ˆ2å¤©ï¼‰
- [ ] å‰ç«¯é˜²æŠ–è‡ªåŠ¨ä¿å­˜
- [ ] LocalStorage è‰ç¨¿ç¼“å­˜
- [ ] æœªä¿å­˜æç¤ºå’Œé¡µé¢æ‹¦æˆª
- [ ] çŠ¶æ€æŒ‡ç¤ºå™¨

#### 1.2 å…¨å±€æœç´¢ï¼ˆ3å¤©ï¼‰
- [ ] åç«¯æœç´¢ APIï¼ˆç« èŠ‚/è§’è‰²/å¤§çº²ï¼‰
- [ ] å‰ç«¯æœç´¢ç»„ä»¶ï¼ˆå¿«æ·é”® Ctrl+Kï¼‰
- [ ] æœç´¢ç»“æœå±•ç¤ºå’Œè·³è½¬
- [ ] é«˜äº®åŒ¹é…å…³é”®è¯

#### 1.3 çŸ­ç¯‡å°è¯´æ”¯æŒï¼ˆ5å¤©ï¼‰
- [ ] Project æ¨¡å‹å¢åŠ  `project_type` å­—æ®µ
- [ ] å‘å¯¼æµç¨‹æ”¹é€ ï¼ˆé¡¹ç›®ç±»å‹é€‰æ‹©ï¼‰
- [ ] ç« èŠ‚ç”Ÿæˆé€»è¾‘ä¼˜åŒ–ï¼ˆå–æ¶ˆé¡ºåºé™åˆ¶ï¼‰
- [ ] å‰ç«¯é€‚é…å’Œæµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯åˆ›å»ºçŸ­ç¯‡/ä¸­ç¯‡/é•¿ç¯‡é¡¹ç›®
- ç« èŠ‚ç¼–è¾‘è‡ªåŠ¨ä¿å­˜ï¼Œæ— æ•°æ®ä¸¢å¤±
- å¯å¿«é€Ÿæœç´¢å¹¶å®šä½ä»»æ„å†…å®¹

---

### Phase 2: åŠŸèƒ½æ‰©å±•ï¼ˆ3-4å‘¨ï¼ŒP1 ä¼˜å…ˆçº§ï¼‰

**ç›®æ ‡**: å¢å¼ºåˆ›ä½œè¾…åŠ©èƒ½åŠ›å’Œå†…å®¹ç®¡ç†æ•ˆç‡

#### 2.1 çµæ„Ÿæ¨¡å¼ï¼ˆ1å‘¨ï¼‰
- [ ] Inspiration æ•°æ®æ¨¡å‹
- [ ] AI çµæ„Ÿç”Ÿæˆ APIï¼ˆæƒ…èŠ‚/è§’è‰²å/ä¸–ç•Œè§‚ï¼‰
- [ ] å‰ç«¯çµæ„Ÿåº“é¡µé¢
- [ ] ä½¿ç”¨åœºæ™¯é›†æˆï¼ˆç« èŠ‚/è§’è‰²åˆ›å»ºï¼‰

#### 2.2 æ‰¹é‡æ“ä½œï¼ˆ3å¤©ï¼‰
- [ ] åç«¯æ‰¹é‡ APIï¼ˆåˆ é™¤/å¯¼å‡º/çŠ¶æ€æ›´æ–°ï¼‰
- [ ] å‰ç«¯å¤šé€‰ UIï¼ˆCheckboxï¼‰
- [ ] æ“ä½œç¡®è®¤æç¤º

#### 2.3 ç‰ˆæœ¬å†å²ç®¡ç†ï¼ˆ1å‘¨ï¼‰
- [ ] ChapterVersion æ•°æ®æ¨¡å‹
- [ ] è‡ªåŠ¨ç‰ˆæœ¬åˆ›å»ºé€»è¾‘
- [ ] ç‰ˆæœ¬ç®¡ç† APIï¼ˆåˆ—è¡¨/æ¢å¤/å¯¹æ¯”ï¼‰
- [ ] å‰ç«¯ç‰ˆæœ¬æ—¶é—´çº¿ UI

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯ä½¿ç”¨ AI ç”Ÿæˆçµæ„Ÿå¹¶åº”ç”¨
- æ”¯æŒæ‰¹é‡åˆ é™¤/å¯¼å‡ºç« èŠ‚
- å¯æ¢å¤ä»»æ„å†å²ç‰ˆæœ¬

---

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆ5-8å‘¨ï¼ŒP1-P2 ä¼˜å…ˆçº§ï¼‰

**ç›®æ ‡**: æä¾›ä¸“ä¸šçº§åˆ›ä½œå·¥å…·å’Œç³»ç»Ÿä¼˜åŒ–

#### 3.1 Prompt æ¨¡æ¿ç³»ç»Ÿï¼ˆ2å‘¨ï¼‰
- [ ] PromptTemplate æ•°æ®æ¨¡å‹å’Œ API
- [ ] å˜é‡æ›¿æ¢å¼•æ“
- [ ] å‰ç«¯å¯è§†åŒ–ç¼–è¾‘ç•Œé¢
- [ ] ç³»ç»Ÿé¢„è®¾æ¨¡æ¿å’Œæµ‹è¯•åŠŸèƒ½

#### 3.2 é¡¹ç›®æ¨¡æ¿ç³»ç»Ÿï¼ˆ1å‘¨ï¼‰
- [ ] ProjectTemplate æ•°æ®æ¨¡å‹
- [ ] æ¨¡æ¿ç®¡ç† API
- [ ] ç³»ç»Ÿé¢„è®¾æ¨¡æ¿ï¼ˆ5ç§ï¼‰
- [ ] å‰ç«¯æ¨¡æ¿é€‰æ‹©ç•Œé¢

#### 3.3 åˆ›ä½œç»Ÿè®¡åˆ†æï¼ˆ1å‘¨ï¼‰
- [ ] WritingStats æ•°æ®æ¨¡å‹
- [ ] ç»Ÿè®¡ API å’Œæ•°æ®è®¡ç®—
- [ ] å‰ç«¯ç»Ÿè®¡ç•Œé¢ï¼ˆæŠ˜çº¿å›¾/çƒ­å›¾ï¼‰
- [ ] æˆå°±ç³»ç»Ÿ

#### 3.4 ç³»ç»Ÿä¼˜åŒ–ï¼ˆæŒç»­ï¼‰
- [ ] é›†æˆ Alembic æ•°æ®åº“è¿ç§»
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ80%+ï¼‰
- [ ] PostgreSQL æ”¯æŒ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯è‡ªå®šä¹‰æ‰€æœ‰ Prompt
- å¯åŸºäºæ¨¡æ¿å¿«é€Ÿåˆ›å»ºé¡¹ç›®
- æä¾›å®Œæ•´çš„åˆ›ä½œç»Ÿè®¡æ•°æ®

---

### Phase 4: é•¿æœŸè§„åˆ’ï¼ˆ2.0 ç‰ˆæœ¬ï¼‰

**ç›®æ ‡**: æ¢ç´¢åˆ›æ–°åŠŸèƒ½å’Œä¼ä¸šçº§èƒ½åŠ›

#### 4.1 é«˜çº§ AI åŠŸèƒ½
- [ ] è®¾å®šè¿½æº¯ä¸çŸ›ç›¾æ£€æµ‹
- [ ] ç« èŠ‚å…³ç³»å›¾è°±å¯è§†åŒ–
- [ ] æ™ºèƒ½ç»­å†™å»ºè®®
- [ ] é£æ ¼è¿ç§»å’Œæ¨¡ä»¿

#### 4.2 åä½œåŠŸèƒ½
- [ ] å¤šäººå®æ—¶åä½œ
- [ ] æƒé™ç®¡ç†ç³»ç»Ÿ
- [ ] è¯„è®ºå’Œæ‰¹æ³¨
- [ ] ä»»åŠ¡åˆ†é…

#### 4.3 å¹³å°æ‰©å±•
- [ ] ç§»åŠ¨ç«¯ App
- [ ] æµè§ˆå™¨æ’ä»¶
- [ ] API å¼€æ”¾å¹³å°
- [ ] ç¤¾åŒºå’Œå¸‚åœº

---

## ä¸ƒã€æ€»ç»“ä¸å»ºè®®

### æ ¸å¿ƒä¼˜åŠ¿ âœ…

1. **å®Œæ•´çš„åˆ›ä½œæµç¨‹**: ä»å‘å¯¼åˆ›å»ºåˆ°ç« èŠ‚ç”Ÿæˆï¼Œè¦†ç›–å°è¯´åˆ›ä½œå…¨ç”Ÿå‘½å‘¨æœŸ
2. **å¤š AI æ¨¡å‹æ”¯æŒ**: çµæ´»é€‰æ‹© OpenAI/Claude/Geminiï¼Œé€‚åº”ä¸åŒéœ€æ±‚
3. **åˆ›æ–° RAG è®°å¿†ç³»ç»Ÿ**: è‡ªåŠ¨è¿½è¸ªå‰§æƒ…å’Œä¼ç¬”ï¼Œæå‡å†…å®¹ä¸€è‡´æ€§
4. **æ¸…æ™°çš„ä»£ç æ¶æ„**: å‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
5. **æµå¼ç”Ÿæˆä½“éªŒ**: SSE å®æ—¶æ¨é€ï¼Œç”¨æˆ·ä½“éªŒæµç•…
6. **å¤šç”¨æˆ·æ•°æ®éš”ç¦»**: å®‰å…¨å¯é çš„ç”¨æˆ·çº§æ•°æ®ç®¡ç†

### ä¸»è¦çŸ­æ¿ âš ï¸

1. **çŸ­ç¯‡å°è¯´æ”¯æŒç¼ºå¤±** â†’ é™åˆ¶ç”¨æˆ·ç¾¤ä½“ï¼Œé™ä½å¸‚åœºè¦†ç›–ç‡
2. **ç¼ºå°‘è‡ªåŠ¨ä¿å­˜** â†’ æ•°æ®ä¸¢å¤±é£é™©ï¼Œå½±å“æ ¸å¿ƒå†™ä½œä½“éªŒ
3. **æ— å…¨å±€æœç´¢** â†’ å¤§å‹é¡¹ç›®ç®¡ç†å›°éš¾ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä½
4. **é«˜çº§åˆ›ä½œè¾…åŠ©ä¸è¶³** â†’ çµæ„Ÿæ¨¡å¼ã€Prompt è‡ªå®šä¹‰ç­‰åŠŸèƒ½ç¼ºå¤±
5. **æ‰¹é‡æ“ä½œå’Œç‰ˆæœ¬ç®¡ç†** â†’ å†…å®¹ç®¡ç†æ•ˆç‡ä½ï¼Œè¯¯æ“ä½œæ— æ³•æ¢å¤

### æˆ˜ç•¥å»ºè®® ğŸ¯

#### 1. èšç„¦æ ¸å¿ƒä½“éªŒï¼ˆPhase 1ï¼‰
- **ä¼˜å…ˆå®ç° P0 åŠŸèƒ½**: è‡ªåŠ¨ä¿å­˜ã€å…¨å±€æœç´¢ã€çŸ­ç¯‡æ”¯æŒ
- **æ—¶é—´æŠ•å…¥**: 1-2 å‘¨
- **é¢„æœŸæ”¶ç›Š**: æ˜¾è‘—æå‡ç”¨æˆ·æ»¡æ„åº¦ï¼Œå‡å°‘æµå¤±ç‡

#### 2. å·®å¼‚åŒ–ç«äº‰ï¼ˆPhase 2ï¼‰
- **çµæ„Ÿæ¨¡å¼**: æ‰“é€ ç‹¬ç‰¹çš„åˆ›ä½œè¾…åŠ©å·¥å…·
- **RAG å¢å¼º**: æ·±åŒ–è®°å¿†ç³»ç»Ÿèƒ½åŠ›ï¼ˆçŸ›ç›¾æ£€æµ‹ã€å…³ç³»å›¾è°±ï¼‰
- **ç¤¾åŒºç”Ÿæ€**: å¼€æ”¾ Prompt æ¨¡æ¿å’Œé¡¹ç›®æ¨¡æ¿å¸‚åœº

#### 3. é•¿æœŸä»·å€¼ï¼ˆPhase 3-4ï¼‰
- **ä¼ä¸šçº§åŠŸèƒ½**: åä½œç¼–è¾‘ã€æƒé™ç®¡ç†ï¼Œé¢å‘å›¢é˜Ÿç”¨æˆ·
- **å¹³å°åŒ–**: API å¼€æ”¾ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ
- **ç§»åŠ¨ç«¯**: è¦†ç›–æ›´å¤šåˆ›ä½œåœºæ™¯

### å…³é”®æŒ‡æ ‡ï¼ˆKPIï¼‰

**ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**:
- ç”¨æˆ·ç•™å­˜ç‡: æå‡ 20%ï¼ˆé€šè¿‡è‡ªåŠ¨ä¿å­˜å’Œæœç´¢ï¼‰
- æ—¥æ´»è·ƒç”¨æˆ·: å¢é•¿ 30%ï¼ˆé€šè¿‡çŸ­ç¯‡æ”¯æŒæ‰©å¤§ç”¨æˆ·ç¾¤ï¼‰
- å¹³å‡åˆ›ä½œæ—¶é•¿: æå‡ 15%ï¼ˆé€šè¿‡çµæ„Ÿæ¨¡å¼å’Œè¾…åŠ©å·¥å…·ï¼‰

**æŠ€æœ¯è´¨é‡æŒ‡æ ‡**:
- æµ‹è¯•è¦†ç›–ç‡: è¾¾åˆ° 80%+
- ä»£ç è´¨é‡è¯„åˆ†: A çº§ï¼ˆSonarQubeï¼‰
- å“åº”æ—¶é—´: æ¥å£ P95 < 500ms

**ä¸šåŠ¡å¢é•¿æŒ‡æ ‡**:
- æ–°ç”¨æˆ·æ³¨å†Œ: æœˆå¢é•¿ 25%
- é¡¹ç›®åˆ›å»ºæ•°: æœˆå¢é•¿ 40%
- ä»˜è´¹è½¬åŒ–ç‡: æå‡ 10%ï¼ˆé€šè¿‡é«˜çº§åŠŸèƒ½ï¼‰

---

## å…«ã€é™„å½•

### A. æŠ€æœ¯å€ºåŠ¡æ¸…å•

| é¡¹ç›® | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | å»ºè®®å¤„ç†æ—¶é—´ |
|------|---------|---------|-------------|
| ç¼ºå°‘ Alembic è¿ç§» | ğŸ”´ é«˜ | æ•°æ®åº“å‡çº§ | Phase 3 |
| å•å…ƒæµ‹è¯•ç¼ºå¤± | ğŸŸ¡ ä¸­ | ä»£ç è´¨é‡ | Phase 2-3 |
| SQLite å¹¶å‘é™åˆ¶ | ğŸŸ¡ ä¸­ | é«˜å¹¶å‘åœºæ™¯ | Phase 3 |
| Prompt ç¡¬ç¼–ç  | ğŸŸ¡ ä¸­ | å¯ç»´æŠ¤æ€§ | Phase 3 |
| é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ | ğŸŸ¢ ä½ | ç”¨æˆ·ä½“éªŒ | æŒç»­ä¼˜åŒ– |

### B. ç«å“åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | MuMuAINovel | NovelAI | Sudowrite | JasperAI |
|------|-------------|---------|-----------|----------|
| å‘å¯¼å¼åˆ›å»º | âœ… | âŒ | âŒ | âŒ |
| å¤š AI æ¨¡å‹ | âœ… | âŒ | âœ… | âœ… |
| RAG è®°å¿† | âœ… | âœ… | âŒ | âŒ |
| ç‰ˆæœ¬å†å² | âŒ | âŒ | âœ… | âœ… |
| åä½œç¼–è¾‘ | âŒ | âŒ | âœ… | âœ… |
| çŸ­ç¯‡æ”¯æŒ | âŒ | âœ… | âœ… | âœ… |
| çµæ„Ÿæ¨¡å¼ | âŒ | âœ… | âœ… | âœ… |
| é¡¹ç›®æ¨¡æ¿ | âŒ | âœ… | âŒ | âœ… |

### C. ç”¨æˆ·åé¦ˆåˆ†æï¼ˆå‡è®¾æ•°æ®ï¼‰

**é«˜é¢‘éœ€æ±‚**:
1. è‡ªåŠ¨ä¿å­˜ï¼ˆ85% ç”¨æˆ·æåŠï¼‰
2. çŸ­ç¯‡å°è¯´æ”¯æŒï¼ˆ70% ç”¨æˆ·æåŠï¼‰
3. å…¨å±€æœç´¢ï¼ˆ65% ç”¨æˆ·æåŠï¼‰
4. ç‰ˆæœ¬å†å²ï¼ˆ60% ç”¨æˆ·æåŠï¼‰
5. çµæ„Ÿç”Ÿæˆï¼ˆ55% ç”¨æˆ·æåŠï¼‰

**ç—›ç‚¹åé¦ˆ**:
- "ç¼–è¾‘æ—¶æµè§ˆå™¨å´©æºƒï¼Œå†…å®¹å…¨ä¸¢äº†" - è‡ªåŠ¨ä¿å­˜ç¼ºå¤±
- "æƒ³å†™çŸ­ç¯‡ä½†å¿…é¡»åˆ›å»º30ç« " - çŸ­ç¯‡æ”¯æŒç¼ºå¤±
- "æ‰¾ä¸åˆ°è§’è‰²åœ¨å“ªç« å‡ºç°è¿‡" - å…¨å±€æœç´¢ç¼ºå¤±
- "AI ç”Ÿæˆæ•ˆæœä¸æ»¡æ„ï¼Œæƒ³è°ƒæ•´æç¤ºè¯" - Prompt ç¼–è¾‘ç¼ºå¤±

---

**æŠ¥å‘Šç¼–å†™æ—¶é—´**: 2025-11-04
**åˆ†æå·¥å…·**: Claude Sonnet 4.5 + Serena MCP + Code Review
**é¡¹ç›®ç‰ˆæœ¬**: åŸºäºå½“å‰ä¸»åˆ†æ”¯ `chaos/å¢åŠ çŸ­ç¯‡èƒ½åŠ›-1104`
**ä¸‹æ¬¡å®¡æŸ¥å»ºè®®**: 3 ä¸ªæœˆåæˆ–å®Œæˆ Phase 1 å

---

## ğŸ“ è”ç³»ä¸åé¦ˆ

å¦‚å¯¹æœ¬åˆ†ææŠ¥å‘Šæœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- GitHub Issues: [é¡¹ç›® Issues](https://github.com/xiamuceer-j/MuMuAINovel/issues)
- é‚®ä»¶: [é¡¹ç›®ç»´æŠ¤è€…é‚®ç®±]

---

**å£°æ˜**: æœ¬æŠ¥å‘ŠåŸºäºä»£ç å®¡æŸ¥å’Œæ¶æ„åˆ†æç”Ÿæˆï¼Œéƒ¨åˆ†å»ºè®®éœ€ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯å’Œç”¨æˆ·åé¦ˆè¿›è¡Œè°ƒæ•´ã€‚ä¼˜å…ˆçº§è¯„ä¼°ä»…ä¾›å‚è€ƒï¼Œå…·ä½“å®æ–½é¡ºåºè¯·æ ¹æ®å›¢é˜Ÿèµ„æºå’Œæˆ˜ç•¥è§„åˆ’å†³å®šã€‚
