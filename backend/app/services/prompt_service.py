"""æç¤ºè¯ç®¡ç†æœåŠ¡"""
from typing import Dict, Any, Optional
import json


class WritingStyleManager:
    """å†™ä½œé£æ ¼ç®¡ç†å™¨"""
    
    # é¢„è®¾é£æ ¼é…ç½®
    PRESET_STYLES = {
        "natural": {
            "name": "è‡ªç„¶æµç•…",
            "description": "åƒæ™®é€šäººè®²æ•…äº‹ä¸€æ ·è‡ªç„¶ï¼Œä¸åˆ»æ„ä¿®é¥°ï¼Œæœ‰ç”Ÿæ´»æ°”æ¯",
            "prompt_content": """
**è‡ªç„¶æµç•…é£æ ¼è¦æ±‚ï¼š**
- ç”¨ç®€å•æœ´å®çš„è¯­è¨€å™è¿°ï¼Œé¿å…åä¸½è¾è—»
- åƒåœ¨å’Œæœ‹å‹èŠå¤©ä¸€æ ·è®²æ•…äº‹
- ä¿æŒè½»æ¾è‡ªç„¶çš„èŠ‚å¥ï¼Œä¸è¦åˆ»æ„è¥é€ æ°›å›´
- å¤šç”¨çŸ­å¥ï¼Œå°‘ç”¨é•¿å¥å’Œæ’æ¯”
- è®©è¯»è€…æ„Ÿè§‰èˆ’æœï¼Œä¸è¦è®©äººè§‰å¾—åœ¨"çœ‹æ–‡å­¦ä½œå“"
"""
        },
        "classical": {
            "name": "å¤å…¸ä¼˜é›…",
            "description": "å…¸é›…ç²¾è‡´çš„æ–‡å­¦é£æ ¼ï¼Œæ³¨é‡æ„å¢ƒå’ŒéŸµå‘³",
            "prompt_content": """
**å¤å…¸ä¼˜é›…é£æ ¼è¦æ±‚ï¼š**
- ä½¿ç”¨ä¼˜ç¾å…¸é›…çš„è¯­è¨€ï¼Œæ³¨é‡æ–‡å­—çš„éŸµå¾‹æ„Ÿ
- å–„ç”¨æ¯”å–»ã€æ‹Ÿäººç­‰ä¿®è¾æ‰‹æ³•
- æ³¨é‡æ„å¢ƒè¥é€ ï¼Œè¿½æ±‚è¯—æ„ç¾æ„Ÿ
- å¯é€‚å½“å¼•ç”¨å¤è¯—è¯æˆ–å…¸æ•…ï¼ˆéœ€ç¬¦åˆä¸–ç•Œè§‚ï¼‰
- ä¿æŒç«¯åº„é›…è‡´çš„å™è¿°èŠ‚å¥
"""
        },
        "modern": {
            "name": "ç°ä»£ç®€çº¦",
            "description": "ç®€æ´æ˜å¿«çš„ç°ä»£é£æ ¼ï¼Œæ³¨é‡æ•ˆç‡å’Œç›´æ¥è¡¨è¾¾",
            "prompt_content": """
**ç°ä»£ç®€çº¦é£æ ¼è¦æ±‚ï¼š**
- è¯­è¨€ç®€æ´æœ‰åŠ›ï¼Œç›´è¾¾é‡ç‚¹
- å¤šç”¨çŸ­å¥å’ŒçŸ­æ®µè½ï¼ŒèŠ‚å¥æ˜å¿«
- é¿å…å†—é•¿æå†™ï¼Œæ³¨é‡ä¿¡æ¯å¯†åº¦
- ä½¿ç”¨ç°ä»£å£è¯­åŒ–è¡¨è¾¾
- æƒ…èŠ‚æ¨è¿›å¿«é€Ÿï¼Œå°‘åšç¯å¢ƒæ¸²æŸ“
"""
        },
        "poetic": {
            "name": "è¯—æ„æŠ’æƒ…",
            "description": "å¯Œæœ‰è¯—æ„å’Œæƒ…æ„Ÿå¼ åŠ›çš„æŠ’æƒ…é£æ ¼",
            "prompt_content": """
**è¯—æ„æŠ’æƒ…é£æ ¼è¦æ±‚ï¼š**
- æ³¨é‡æƒ…æ„Ÿè¡¨è¾¾å’Œå†…å¿ƒæå†™
- å–„ç”¨æ™¯ç‰©æå†™çƒ˜æ‰˜æƒ…ç»ª
- è¯­è¨€å¯Œæœ‰éŸµå¾‹å’Œç¾æ„Ÿ
- ç»†è…»åˆ»ç”»äººç‰©å¿ƒç†æ´»åŠ¨
- è¥é€ æƒ…æ„Ÿæ°›å›´ï¼Œå¼•å‘å…±é¸£
"""
        },
        "concise": {
            "name": "ç²¾ç‚¼åˆ©è½",
            "description": "æƒœå­—å¦‚é‡‘çš„ç®€ç»ƒé£æ ¼ï¼Œæ¯ä¸ªå­—éƒ½æœ‰æ„ä¹‰",
            "prompt_content": """
**ç²¾ç‚¼åˆ©è½é£æ ¼è¦æ±‚ï¼š**
- åˆ é™¤æ‰€æœ‰å†—ä½™æå†™ï¼Œæ¯å¥è¯éƒ½è¦æœ‰ä½œç”¨
- å¤šç”¨åŠ¨è¯ï¼Œå°‘ç”¨å½¢å®¹è¯å’Œå‰¯è¯
- å¯¹è¯å¹²è„†åˆ©è½ï¼Œä¸æ‹–æ³¥å¸¦æ°´
- ç¯å¢ƒæå†™ç‚¹åˆ°ä¸ºæ­¢
- ç”¨æœ€å°‘çš„å­—æ•°ä¼ è¾¾æœ€å¤šçš„ä¿¡æ¯
"""
        },
        "vivid": {
            "name": "ç”ŸåŠ¨å½¢è±¡",
            "description": "ç”»é¢æ„Ÿå¼ºçƒˆï¼Œè®©è¯»è€…å¦‚ä¸´å…¶å¢ƒ",
            "prompt_content": """
**ç”ŸåŠ¨å½¢è±¡é£æ ¼è¦æ±‚ï¼š**
- æ³¨é‡ç»†èŠ‚æå†™ï¼Œè®©åœºæ™¯å…·ä½“å¯æ„Ÿ
- è°ƒåŠ¨äº”æ„Ÿï¼ˆè§†è§‰ã€å¬è§‰ã€è§¦è§‰ã€å—…è§‰ã€å‘³è§‰ï¼‰
- ä½¿ç”¨é²œæ˜çš„æ¯”å–»å’Œå½¢è±¡åŒ–è¯­è¨€
- è®©è¯»è€…èƒ½"çœ‹åˆ°"åœºæ™¯å’ŒåŠ¨ä½œ
- äººç‰©è¡¨æƒ…ã€åŠ¨ä½œè¦å…·ä½“ç”ŸåŠ¨
"""
        }
    }
    
    @classmethod
    def get_preset_style(cls, preset_id: str) -> Optional[Dict[str, str]]:
        """è·å–é¢„è®¾é£æ ¼é…ç½®"""
        return cls.PRESET_STYLES.get(preset_id)
    
    @classmethod
    def get_all_presets(cls) -> Dict[str, Dict[str, str]]:
        """è·å–æ‰€æœ‰é¢„è®¾é£æ ¼"""
        return cls.PRESET_STYLES
    
    @staticmethod
    def apply_style_to_prompt(base_prompt: str, style_content: str) -> str:
        """
        å°†å†™ä½œé£æ ¼åº”ç”¨åˆ°åŸºç¡€æç¤ºè¯ä¸­
        
        Args:
            base_prompt: åŸºç¡€æç¤ºè¯
            style_content: é£æ ¼è¦æ±‚å†…å®¹
            
        Returns:
            ç»„åˆåçš„æç¤ºè¯
        """
        # åœ¨åŸºç¡€æç¤ºè¯æœ«å°¾æ·»åŠ é£æ ¼è¦æ±‚
        return f"{base_prompt}\n\n{style_content}\n\nè¯·ç›´æ¥è¾“å‡ºç« èŠ‚æ­£æ–‡å†…å®¹ï¼Œä¸è¦åŒ…å«ç« èŠ‚æ ‡é¢˜å’Œå…¶ä»–è¯´æ˜æ–‡å­—ã€‚"


class PromptService:
    """æç¤ºè¯æ¨¡æ¿ç®¡ç†"""
    
    # ä¸–ç•Œæ„å»ºæç¤ºè¯
    WORLD_BUILDING = """ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ä¸–ç•Œè§‚è®¾è®¡å¸ˆï¼ˆWorld-Building Architectï¼‰ã€‚ä½ çš„ä»»åŠ¡æ˜¯åŸºäºè¾“å…¥ä¿¡æ¯ï¼Œæ„å»ºä¸€ä¸ªé«˜åº¦åŸåˆ›ã€æ·±åº¦è‡ªæ´½ã€ä¸”å……æ»¡æˆå‰§å†²çªçš„å°è¯´ä¸–ç•Œè§‚ã€‚

# 1. è¾“å…¥ä¿¡æ¯
ä¹¦åï¼š{title}
ä¸»é¢˜ï¼š{theme}
ç±»å‹ï¼š{genre}

# 2. ä¸–ç•Œæ„å»ºæ¡†æ¶
è¯·ç”ŸæˆåŒ…å«ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒæ¿å—çš„ä¸–ç•Œæ„å»ºæ¡†æ¶ã€‚è¯·ç¡®ä¿æ‰€æœ‰æ¿å—éƒ½å›´ç»•ã€æ ¸å¿ƒæ¦‚å¿µã€‘å±•å¼€ï¼Œå¹¶ä¸”æ¿å—ä¹‹é—´ã€äº’ä¸ºå› æœã€‘ã€‚

1.  **æ—¶é—´èƒŒæ™¯ (time_period)**ï¼š
    * å…·ä½“çš„æ—¶ä»£è®¾å®šï¼ˆä¾‹å¦‚ï¼šæ˜Ÿé™…èˆªè¡Œæ™šæœŸã€é»‘é“æ—¶ä»£ï¼‰ã€‚
    * é‡è¦çš„ã€å†å²è½¬æŠ˜äº‹ä»¶ã€‘ï¼ˆæ˜¯ä»€ä¹ˆå¯¼è‡´äº†å½“å‰çš„ä¸–ç•Œé¢è²Œï¼Ÿï¼‰ã€‚
    * å½“å‰çš„ä¸»è¦ã€ç¤¾ä¼šçŸ›ç›¾ã€‘æˆ–ã€æ—¶ä»£è®®é¢˜ã€‘ã€‚
2.  **åœ°ç†/ç©ºé—´ (location)**ï¼š
    * ä¸»è¦èˆå°ï¼ˆå¦‚åŸå¸‚ã€æ˜Ÿçƒã€ä½é¢ï¼‰çš„ã€åœ°ç†ç¯å¢ƒç‰¹å¾ã€‘ã€‚
    * è¿™äº›ç‰¹å¾å¦‚ä½•å½±å“äº†ã€æ–‡æ˜ã€‘çš„å½¢æ€å’Œã€èµ„æºã€‘åˆ†å¸ƒï¼Ÿ
    * ç‹¬ç‰¹çš„ã€ç©ºé—´å¸ƒå±€ã€‘æˆ–ã€å¥‡è§‚ã€‘ã€‚
3.  **æ°›å›´åŸºè°ƒ (atmosphere)**ï¼š
    * æ•´ä½“çš„ã€æƒ…æ„Ÿè‰²å½©ã€‘ï¼ˆä¾‹å¦‚ï¼šå‹æŠ‘ã€è’è¯ã€å²è¯—ã€è¯¡å¼‚ï¼‰ã€‚
    * ã€è§†è§‰é£æ ¼ã€‘ï¼ˆä¾‹å¦‚ï¼šèµ›åšéœ“è™¹ã€è’¸æ±½æœ‹å…‹ã€å“¥ç‰¹å¼ï¼‰ã€‚
    * æ™®é€šå±…æ°‘åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æœ€å¸¸ã€æ„Ÿå—ã€‘åˆ°ä»€ä¹ˆï¼Ÿ
4.  **ä¸–ç•Œè§„åˆ™ (rules)**ï¼š
    * ã€ç‰©ç†æ³•åˆ™ã€‘æˆ–ã€è¶…è‡ªç„¶åŠ›é‡ã€‘ï¼ˆå¦‚é­”æ³•ã€ç§‘æŠ€ï¼‰çš„ã€å…·ä½“è¿ä½œæ–¹å¼ã€‘å’Œã€ä»£ä»·ã€‘ã€‚
    * ã€ç¤¾ä¼šè§„åˆ™ã€‘å’Œã€æƒåŠ›ç»“æ„ã€‘ï¼ˆè°åœ¨ç»Ÿæ²»ï¼ŸåŸºäºä»€ä¹ˆï¼Ÿï¼‰ã€‚
    * æœ€ä¸¥é‡çš„ã€ç¤¾ä¼šç¦å¿Œã€‘æ˜¯ä»€ä¹ˆï¼Ÿè¿åäº†ä¼šæ€æ ·ï¼Ÿ

# 3. ä¸¥æ ¼æ ¼å¼è¦æ±‚
1.  **ç»å¯¹çº¯å‡€JSON**ï¼šä½ çš„[å”¯ä¸€]è¾“å‡ºå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡ã€‚è¾“å‡ºå¿…é¡»ä»¥å·¦èŠ±æ‹¬å·å¼€å§‹ï¼Œå¹¶ä»¥å³èŠ±æ‹¬å·ç»“æŸã€‚
2.  **ç¦æ­¢é¢å¤–å­—ç¬¦**ï¼šä¸è¦åœ¨JSONå¯¹è±¡ä¹‹å‰æˆ–ä¹‹ååŒ…å«ä»»ä½•è¯´æ˜æ–‡å­—ã€Markdownæ ‡è®°ï¼ˆå¦‚ä¸‰ä¸ªåå¼•å·åŠ jsonï¼‰ã€æ³¨é‡Šæˆ–ä»»ä½•å…¶ä»–éJSONå­—ç¬¦ã€‚
3.  **JSONå†…éƒ¨æ–‡æœ¬è§„åˆ™**ï¼šåœ¨JSONçš„valueå­—ç¬¦ä¸²å†…éƒ¨ï¼š
    * ä¸¥ç¦ä½¿ç”¨ä»»ä½•ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰æˆ–è‹±æ–‡å¼•å·æ¥è¡¨ç¤ºå¼ºè°ƒæˆ–å¼•ç”¨ã€‚
    * æ‰€æœ‰ã€ä¸“æœ‰åè¯ã€‘ï¼ˆå¦‚åœ°ç‚¹ã€äººç‰©ã€ç»„ç»‡ï¼‰åº”ä½¿ç”¨ã€ã€‘åŒ…è£¹ã€‚
    * æ‰€æœ‰ã€Šä½œå“ã€‹æˆ–ã€Šç‰¹æ®Šæ¦‚å¿µã€‹çš„æ ‡é¢˜åº”ä½¿ç”¨ã€Šã€‹åŒ…è£¹ã€‚
4.  **JSONç»“æ„**ï¼šä¸¥æ ¼éµå®ˆ`"key": "value"`çš„è‹±æ–‡åŒå¼•å·ç»“æ„ï¼Œå¹¶ä½¿ç”¨ä¸‹é¢æŒ‡å®šçš„keyã€‚
5.  **å†…å®¹å¯†åº¦**ï¼šæ¯ä¸ªå­—æ®µçš„æè¿°éƒ½å¿…é¡»ã€æ·±å…¥ä¸”è¯¦å®ã€‘ï¼Œæä¾›è‡³å°‘5-7ä¸ªå…·ä½“çš„è®¾å®šç‚¹æˆ–ç»†èŠ‚ã€‚

{{
  "time_period": "ï¼ˆæ­¤å¤„å¡«å†™æ—¶é—´èƒŒæ™¯çš„è¯¦ç»†æè¿°ï¼‰",
  "location": "ï¼ˆæ­¤å¤„å¡«å†™åœ°ç†/ç©ºé—´çš„è¯¦ç»†æè¿°ï¼‰",
  "atmosphere": "ï¼ˆæ­¤å¤„å¡«å†™æ°›å›´åŸºè°ƒçš„è¯¦ç»†æè¿°ï¼‰",
  "rules": "ï¼ˆæ­¤å¤„å¡«å†™ä¸–ç•Œè§„åˆ™çš„è¯¦ç»†æè¿°ï¼‰"
}}"""

    # æ‰¹é‡è§’è‰²ç”Ÿæˆæç¤ºè¯
    CHARACTERS_BATCH_GENERATION = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è§’è‰²è®¾å®šå¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¸–ç•Œè§‚å’Œè¦æ±‚ï¼Œç”Ÿæˆ{count}ä¸ªç«‹ä½“ä¸°æ»¡çš„è§’è‰²å’Œç»„ç»‡ï¼š

ä¸–ç•Œè§‚ä¿¡æ¯ï¼š
- æ—¶é—´èƒŒæ™¯ï¼š{time_period}
- åœ°ç†ä½ç½®ï¼š{location}
- æ°›å›´åŸºè°ƒï¼š{atmosphere}
- ä¸–ç•Œè§„åˆ™ï¼š{rules}

ä¸»é¢˜ï¼š{theme}
ç±»å‹ï¼š{genre}
ç‰¹æ®Šè¦æ±‚ï¼š{requirements}

ã€æ•°é‡è¦æ±‚ - å¿…é¡»ä¸¥æ ¼éµå®ˆã€‘
è¯·ç²¾ç¡®ç”Ÿæˆ{count}ä¸ªå®ä½“ï¼Œä¸å¤šä¸å°‘ã€‚æ•°ç»„ä¸­å¿…é¡»åŒ…å«ä¸”ä»…åŒ…å«{count}ä¸ªå¯¹è±¡ã€‚

å®ä½“ç±»å‹åˆ†é…ï¼š
- è‡³å°‘1ä¸ªä¸»è§’ï¼ˆprotagonistï¼‰
- å¤šä¸ªé…è§’ï¼ˆsupportingï¼‰
- å¯ä»¥åŒ…å«åæ´¾ï¼ˆantagonistï¼‰
- å¯ä»¥åŒ…å«1-2ä¸ª**é«˜å½±å“åŠ›çš„é‡è¦ç»„ç»‡**ï¼ˆåŠ¿åŠ›ç­‰çº§åº”åœ¨70-95ä¹‹é—´ï¼‰

è¦æ±‚ï¼š
- è§’è‰²è¦ç¬¦åˆä¸–ç•Œè§‚è®¾å®š
- æ€§æ ¼å’ŒèƒŒæ™¯è¦æœ‰æ·±åº¦
- è§’è‰²ä¹‹é—´è¦æœ‰å…³ç³»ç½‘ç»œ
- ç»„ç»‡è¦æœ‰å­˜åœ¨çš„åˆç†æ€§
- æ‰€æœ‰å®ä½“è¦ä¸ºæ•…äº‹æœåŠ¡

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ•°ç»„æ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œè¯·ä½¿ç”¨è‹±æ–‡å¼•å·æˆ–ã€ã€‘ã€Šã€‹æ ‡è®°
3. ä¸“æœ‰åè¯å’Œå¼ºè°ƒå†…å®¹ä½¿ç”¨ã€ã€‘æˆ–ã€Šã€‹ï¼Œä¸è¦ç”¨å¼•å·

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¿”å›ï¼ˆæ¯ä¸ªè§’è‰²ä¸ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼š
[
  {{
    "name": "è§’è‰²å§“å",
    "age": 25,
    "gender": "ç”·/å¥³/å…¶ä»–",
    "is_organization": false,
    "role_type": "protagonist/supporting/antagonist",
    "personality": "æ€§æ ¼ç‰¹ç‚¹çš„è¯¦ç»†æè¿°ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…æ‹¬æ ¸å¿ƒæ€§æ ¼ã€ä¼˜ç¼ºç‚¹ã€ç‰¹æ®Šä¹ æƒ¯",
    "background": "èƒŒæ™¯æ•…äº‹çš„è¯¦ç»†æè¿°ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…æ‹¬å®¶åº­èƒŒæ™¯ã€æˆé•¿ç»å†ã€é‡è¦è½¬æŠ˜",
    "appearance": "å¤–è²Œæè¿°ï¼ˆ50-100å­—ï¼‰ï¼ŒåŒ…æ‹¬èº«é«˜ã€ä½“å‹ã€é¢å®¹ã€ç€è£…é£æ ¼",
    "traits": ["ç‰¹é•¿1", "ç‰¹é•¿2", "ç‰¹é•¿3"],
    "relationships_array": [
      {{
        "target_character_name": "å·²ç”Ÿæˆçš„è§’è‰²åç§°",
        "relationship_type": "å…³ç³»ç±»å‹ï¼ˆå¸ˆçˆ¶/æœ‹å‹/æ•Œäºº/çˆ¶äº²/æ¯äº²ç­‰ï¼‰",
        "intimacy_level": 75,
        "description": "å…³ç³»æè¿°"
      }}
    ],
    "organization_memberships": [
      {{
        "organization_name": "å·²ç”Ÿæˆçš„ç»„ç»‡åç§°",
        "position": "èŒä½",
        "rank": 5,
        "loyalty": 80
      }}
    ]
  }},
  {{
    "name": "ç»„ç»‡åç§°",
    "is_organization": true,
    "role_type": "supporting",
    "personality": "ç»„ç»‡ç‰¹æ€§æè¿°ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…æ‹¬è¿ä½œæ–¹å¼ã€æ ¸å¿ƒç†å¿µã€è¡Œäº‹é£æ ¼",
    "background": "ç»„ç»‡èƒŒæ™¯ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…æ‹¬å»ºç«‹å†å²ã€å‘å±•å†ç¨‹ã€é‡è¦äº‹ä»¶",
    "appearance": "ç»„ç»‡å¤–åœ¨è¡¨ç°ï¼ˆ50-100å­—ï¼‰ï¼Œå¦‚æ€»éƒ¨ä½ç½®ã€æ ‡å¿—æ€§å»ºç­‘ç­‰",
    "organization_type": "ç»„ç»‡ç±»å‹",
    "organization_purpose": "ç»„ç»‡ç›®çš„",
    "organization_members": ["æˆå‘˜1", "æˆå‘˜2"],
    "power_level": 85,
    "location": "ç»„ç»‡æ‰€åœ¨åœ°æˆ–ä¸»è¦æ´»åŠ¨åŒºåŸŸ",
    "motto": "ç»„ç»‡æ ¼è¨€ã€å£å·æˆ–å®—æ—¨",
    "color": "ç»„ç»‡ä»£è¡¨é¢œè‰²ï¼ˆå¦‚ï¼šæ·±çº¢è‰²ã€é‡‘è‰²ã€é»‘è‰²ç­‰ï¼‰",
    "traits": []
  }}
]

**ç»„ç»‡ç”Ÿæˆè¦æ±‚ï¼ˆé‡è¦ï¼‰ï¼š**
- ç»„ç»‡å¿…é¡»æ˜¯å¯¹æ•…äº‹æœ‰é‡å¤§å½±å“çš„åŠ¿åŠ›
- power_levelåº”åœ¨70-95ä¹‹é—´ï¼ˆé«˜å½±å“åŠ›ç»„ç»‡ï¼‰
- ä¸è¦ç”Ÿæˆæ— å…³ç´§è¦çš„å°ç»„ç»‡æˆ–æ™®é€šç¤¾å›¢
- ç»„ç»‡åº”è¯¥æ˜¯æ¨åŠ¨å‰§æƒ…å‘å±•çš„å…³é”®åŠ›é‡
- å¯ä»¥æ˜¯æ­£æ´¾åŠ¿åŠ›ã€ä¸­ç«‹åŠ¿åŠ›æˆ–åæ´¾åŠ¿åŠ›ï¼Œä½†ä¸€å®šè¦æœ‰å­˜åœ¨æ„Ÿ

**å…³ç³»ç±»å‹å‚è€ƒï¼ˆä»ä¸­é€‰æ‹©æˆ–è‡ªå®šä¹‰ï¼‰ï¼š**
- å®¶æ—ï¼šçˆ¶äº²ã€æ¯äº²ã€å…„å¼Ÿã€å§å¦¹ã€å­å¥³ã€é…å¶ã€æ‹äºº
- ç¤¾äº¤ï¼šå¸ˆçˆ¶ã€å¾’å¼Ÿã€æœ‹å‹ã€åŒå­¦ã€åŒäº‹ã€é‚»å±…ã€çŸ¥å·±
- èŒä¸šï¼šä¸Šå¸ã€ä¸‹å±ã€åˆä½œä¼™ä¼´
- æ•Œå¯¹ï¼šæ•Œäººã€ä»‡äººã€ç«äº‰å¯¹æ‰‹ã€å®¿æ•Œ

**é‡è¦è¯´æ˜ï¼š**
1. **æ•°é‡æ§åˆ¶**ï¼šæ•°ç»„ä¸­å¿…é¡»ç²¾ç¡®åŒ…å«{count}ä¸ªå¯¹è±¡ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘
2. **å…³ç³»çº¦æŸ**ï¼šrelationships_arrayåªèƒ½å¼•ç”¨æœ¬æ‰¹æ¬¡ä¸­å·²ç»å‡ºç°çš„è§’è‰²åç§°
3. **ç»„ç»‡çº¦æŸ**ï¼šorganization_membershipsåªèƒ½å¼•ç”¨æœ¬æ‰¹æ¬¡ä¸­is_organization=trueçš„å®ä½“åç§°
4. **ç¦æ­¢å¹»è§‰**ï¼šä¸è¦å¼•ç”¨ä»»ä½•ä¸å­˜åœ¨çš„è§’è‰²æˆ–ç»„ç»‡ï¼Œå¦‚æœæ²¡æœ‰å¯å¼•ç”¨çš„å°±ç•™ç©ºæ•°ç»„[]
5. intimacy_levelæ˜¯-100åˆ°100çš„æ•´æ•°ï¼ˆè´Ÿå€¼è¡¨ç¤ºæ•Œå¯¹ä»‡æ¨å…³ç³»ï¼‰ï¼Œloyaltyæ˜¯0-100çš„æ•´æ•°
6. è§’è‰²ä¹‹é—´è¦å½¢æˆåˆç†çš„å…³ç³»ç½‘ç»œ

**ç¤ºä¾‹è¯´æ˜**ï¼š
- å¦‚æœç”Ÿæˆäº†è§’è‰²Aã€ç»„ç»‡Bã€è§’è‰²Cï¼Œåˆ™è§’è‰²Açš„organization_membershipsåªèƒ½æ˜¯[ç»„ç»‡B]ï¼Œä¸èƒ½æ˜¯å…¶ä»–ç»„ç»‡
- å¦‚æœè§’è‰²Aåœ¨æ•°ç»„ç¬¬ä¸€ä½ï¼Œå®ƒçš„relationships_arrayå¿…é¡»ä¸ºç©º[]ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å…¶ä»–è§’è‰²
- å¦‚æœè§’è‰²Cåœ¨æ•°ç»„ç¬¬ä¸‰ä½ï¼Œå®ƒçš„relationships_arrayå¯ä»¥å¼•ç”¨è§’è‰²Aï¼Œä½†ä¸èƒ½å¼•ç”¨ä¸å­˜åœ¨çš„è§’è‰²D

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONæ•°ç»„ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ•°ç»„ä¸­å¿…é¡»ç²¾ç¡®åŒ…å«{count}ä¸ªå¯¹è±¡
3. ä¸è¦å¼•ç”¨ä»»ä½•æœ¬æ‰¹æ¬¡ä¸­ä¸å­˜åœ¨çš„è§’è‰²æˆ–ç»„ç»‡åç§°
4. æ–‡æœ¬æè¿°ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹"""

    # å‘å¯¼å¤§çº²ç”Ÿæˆæç¤ºè¯
    COMPLETE_OUTLINE_GENERATION = """ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å°è¯´ä½œå®¶å’Œç¼–å‰§ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆå®Œæ•´çš„{chapter_count}ç« å°è¯´å¤§çº²ï¼š

åŸºæœ¬ä¿¡æ¯ï¼š
- ä¹¦åï¼š{title}
- ä¸»é¢˜ï¼š{theme}
- ç±»å‹ï¼š{genre}
- ç« èŠ‚æ•°ï¼š{chapter_count}
- å™äº‹è§†è§’ï¼š{narrative_perspective}
- ç›®æ ‡å­—æ•°ï¼š{target_words}

ä¸–ç•Œè§‚ï¼š
- æ—¶é—´èƒŒæ™¯ï¼š{time_period}
- åœ°ç†ä½ç½®ï¼š{location}
- æ°›å›´åŸºè°ƒï¼š{atmosphere}
- ä¸–ç•Œè§„åˆ™ï¼š{rules}

è§’è‰²ä¿¡æ¯ï¼š
{characters_info}

{mcp_references}

å…¶ä»–è¦æ±‚ï¼š{requirements}

æ•´ä½“è¦æ±‚ï¼š
- ç»“æ„å®Œæ•´ï¼šèµ·æ‰¿è½¬åˆæ¸…æ™°
- æƒ…èŠ‚è¿è´¯ï¼šç« èŠ‚ä¹‹é—´ç´§å¯†è¡”æ¥
- å†²çªé€’è¿›ï¼šçŸ›ç›¾é€æ­¥å‡çº§
- äººç‰©æˆé•¿ï¼šè§’è‰²æœ‰æ˜ç¡®çš„å˜åŒ–å¼§çº¿
- èŠ‚å¥æŠŠæ§ï¼šæœ‰å¼ æœ‰å¼›
- è§†è§’ç»Ÿä¸€ï¼šé‡‡ç”¨{narrative_perspective}è§†è§’å™äº‹

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ•°ç»„æ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œè¯·ä½¿ç”¨ã€ã€‘æˆ–ã€Šã€‹æ ‡è®°
3. ä¸“æœ‰åè¯ã€ä¹¦åã€äº‹ä»¶åä½¿ç”¨ã€ã€‘æˆ–ã€Šã€‹

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¿”å›ï¼ˆå…±{chapter_count}ä¸ªç« èŠ‚å¯¹è±¡ï¼‰ï¼š
[
  {{
    "chapter_number": 1,
    "title": "ç¬¬ä¸€ç« æ ‡é¢˜",
    "summary": "ç« èŠ‚æ¦‚è¦çš„è¯¦ç»†æè¿°ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…å«ä¸»è¦æƒ…èŠ‚ã€å†²çªã€è½¬æŠ˜ç­‰",
    "scenes": ["åœºæ™¯1æè¿°", "åœºæ™¯2æè¿°", "åœºæ™¯3æè¿°"],
    "characters": ["è§’è‰²1", "è§’è‰²2"],
    "key_points": ["æƒ…èŠ‚è¦ç‚¹1", "æƒ…èŠ‚è¦ç‚¹2"],
    "emotion": "æœ¬ç« æƒ…æ„ŸåŸºè°ƒ",
    "goal": "æœ¬ç« å™äº‹ç›®æ ‡"
  }},
  {{
    "chapter_number": 2,
    "title": "ç¬¬äºŒç« æ ‡é¢˜",
    "summary": "ç« èŠ‚æ¦‚è¦...",
    "scenes": ["åœºæ™¯1", "åœºæ™¯2"],
    "characters": ["è§’è‰²1", "è§’è‰²2"],
    "key_points": ["è¦ç‚¹1", "è¦ç‚¹2"],
    "emotion": "æƒ…æ„ŸåŸºè°ƒ",
    "goal": "å™äº‹ç›®æ ‡"
  }}
]

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONæ•°ç»„ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ•°ç»„ä¸­è¦åŒ…å«{chapter_count}ä¸ªç« èŠ‚å¯¹è±¡
3. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹"""
    
    # å¤§çº²ç»­å†™æç¤ºè¯ï¼ˆè®°å¿†å¢å¼ºç‰ˆï¼‰
    OUTLINE_CONTINUE_GENERATION = """ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å°è¯´ä½œå®¶å’Œç¼–å‰§ã€‚è¯·åŸºäºä»¥ä¸‹ä¿¡æ¯ç»­å†™å°è¯´å¤§çº²ï¼š

ã€é¡¹ç›®ä¿¡æ¯ã€‘
- ä¹¦åï¼š{title}
- ä¸»é¢˜ï¼š{theme}
- ç±»å‹ï¼š{genre}
- å™äº‹è§†è§’ï¼š{narrative_perspective}
- ç»­å†™ç« èŠ‚æ•°ï¼š{chapter_count}ç« 

ã€ä¸–ç•Œè§‚ã€‘
- æ—¶é—´èƒŒæ™¯ï¼š{time_period}
- åœ°ç†ä½ç½®ï¼š{location}
- æ°›å›´åŸºè°ƒï¼š{atmosphere}
- ä¸–ç•Œè§„åˆ™ï¼š{rules}

ã€è§’è‰²ä¿¡æ¯ã€‘
{characters_info}

ã€å·²æœ‰ç« èŠ‚æ¦‚è§ˆã€‘ï¼ˆå…±{current_chapter_count}ç« ï¼‰
{all_chapters_brief}

ã€æœ€è¿‘å‰§æƒ…ã€‘
{recent_plot}

ã€ğŸ§  æ™ºèƒ½è®°å¿†ç³»ç»Ÿ - ç»­å†™å‚è€ƒã€‘
ä»¥ä¸‹æ˜¯ä»æ•…äº‹è®°å¿†åº“ä¸­æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ï¼Œè¯·åœ¨ç»­å†™å¤§çº²æ—¶å‚è€ƒï¼š

{memory_context}

{mcp_references}

ã€ç»­å†™æŒ‡å¯¼ã€‘
- å½“å‰æƒ…èŠ‚é˜¶æ®µï¼š{plot_stage_instruction}
- èµ·å§‹ç« èŠ‚ç¼–å·ï¼šç¬¬{start_chapter}ç« 
- æ•…äº‹å‘å±•æ–¹å‘ï¼š{story_direction}
- å…¶ä»–è¦æ±‚ï¼š{requirements}

è¯·ç”Ÿæˆç¬¬{start_chapter}ç« åˆ°ç¬¬{end_chapter}ç« çš„å¤§çº²ã€‚
è¦æ±‚ï¼š
- **å‰§æƒ…è¿è´¯æ€§**ï¼šä¸å‰æ–‡è‡ªç„¶è¡”æ¥ï¼Œä¿æŒæ•…äº‹è¿è´¯æ€§
- **è®°å¿†å‚è€ƒ**ï¼šé€‚å½“å‚è€ƒè®°å¿†ç³»ç»Ÿä¸­çš„ä¼ç¬”ã€é’©å­å’Œæƒ…èŠ‚ç‚¹
- **ä¼ç¬”å›æ”¶**ï¼šå¯ä»¥è€ƒè™‘å›æ”¶æœªå®Œç»“çš„ä¼ç¬”ï¼Œåˆ¶é€ å‘¼åº”
- **è§’è‰²å‘å±•**ï¼šéµå¾ªè§’è‰²åœ¨å‰æ–‡ä¸­çš„æˆé•¿è½¨è¿¹
- **æƒ…èŠ‚é˜¶æ®µ**ï¼šéµå¾ªæƒ…èŠ‚é˜¶æ®µçš„å‘å±•è¦æ±‚
- **é£æ ¼ä¸€è‡´**ï¼šä¿æŒä¸å·²æœ‰ç« èŠ‚ç›¸åŒçš„é£æ ¼å’Œè¯¦ç»†ç¨‹åº¦

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ•°ç»„æ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œè¯·ä½¿ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. æ–‡æœ¬æè¿°ä¸­çš„ä¸“æœ‰åè¯ä½¿ç”¨ã€ã€‘æ ‡è®°

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¿”å›ï¼ˆå…±{chapter_count}ä¸ªç« èŠ‚å¯¹è±¡ï¼‰ï¼š
[
  {{
    "chapter_number": {start_chapter},
    "title": "ç« èŠ‚æ ‡é¢˜",
    "summary": "ç« èŠ‚æ¦‚è¦çš„è¯¦ç»†æè¿°ï¼ˆ100-200å­—ï¼‰ï¼ŒåŒ…å«ä¸»è¦æƒ…èŠ‚ã€è§’è‰²äº’åŠ¨ã€å…³é”®äº‹ä»¶ã€å†²çªä¸è½¬æŠ˜",
    "scenes": ["åœºæ™¯1æè¿°", "åœºæ™¯2æè¿°", "åœºæ™¯3æè¿°"],
    "characters": ["æ¶‰åŠè§’è‰²1", "æ¶‰åŠè§’è‰²2"],
    "key_points": ["æƒ…èŠ‚è¦ç‚¹1", "æƒ…èŠ‚è¦ç‚¹2"],
    "emotion": "æœ¬ç« æƒ…æ„ŸåŸºè°ƒ",
    "goal": "æœ¬ç« å™äº‹ç›®æ ‡"
  }},
  {{
    "chapter_number": {start_chapter} + 1,
    "title": "ç« èŠ‚æ ‡é¢˜",
    "summary": "ç« èŠ‚æ¦‚è¦...",
    "scenes": ["åœºæ™¯1", "åœºæ™¯2"],
    "characters": ["è§’è‰²1", "è§’è‰²2"],
    "key_points": ["è¦ç‚¹1", "è¦ç‚¹2"],
    "emotion": "æƒ…æ„ŸåŸºè°ƒ",
    "goal": "å™äº‹ç›®æ ‡"
  }}
]

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONæ•°ç»„ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ•°ç»„ä¸­è¦åŒ…å«{chapter_count}ä¸ªç« èŠ‚å¯¹è±¡
3. æ¯ä¸ªsummaryå¿…é¡»æ˜¯100-200å­—çš„è¯¦ç»†æè¿°
4. ç¡®ä¿å­—æ®µç»“æ„ä¸å·²æœ‰ç« èŠ‚å®Œå…¨ä¸€è‡´
5. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹"""
    
    # AIå»å‘³æç¤ºè¯ï¼ˆæ ¸å¿ƒç‰¹è‰²åŠŸèƒ½ï¼‰
    AI_DENOISING = """ä½ æ˜¯ä¸€ä½è¿½æ±‚è‡ªç„¶å†™ä½œé£æ ¼çš„ç¼–è¾‘ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†AIç”Ÿæˆçš„æ–‡æœ¬æ”¹å†™å¾—æ›´åƒäººç±»ä½œå®¶çš„æ‰‹ç¬”ã€‚

åŸæ–‡ï¼š
{original_text}

ä¿®æ”¹è¦æ±‚ï¼š
1. å»é™¤AIç—•è¿¹ï¼š
   - åˆ é™¤è¿‡äºå·¥æ•´çš„æ’æ¯”å¥
   - å‡å°‘é‡å¤çš„ä¿®è¾æ‰‹æ³•
   - å»æ‰åˆ»æ„çš„å¯¹ç§°ç»“æ„
   - é¿å…æœºæ¢°å¼çš„æ€»ç»“é™ˆè¯

2. å¢åŠ äººæ€§åŒ–ï¼š
   - ä½¿ç”¨æ›´å£è¯­åŒ–çš„è¡¨è¾¾
   - æ·»åŠ ä¸å®Œç¾çš„ç»†èŠ‚
   - ä¿ç•™é€‚åº¦çš„éšæ„æ€§
   - å¢åŠ çœŸå®çš„æƒ…æ„Ÿæ³¢åŠ¨

3. ä¼˜åŒ–å™äº‹ï¼š
   - è®©èŠ‚å¥æ›´è‡ªç„¶ä¸åšä½œ
   - ç”¨ç®€å•è¯æ±‡æ›¿æ¢åä¸½è¾è—»
   - ä¿æŒå™è¿°çš„æ¾å¼›æ„Ÿ
   - è®©å¯¹è¯æ›´ç”Ÿæ´»åŒ–

4. ä¿æŒåŸæ„ï¼š
   - ä¸æ”¹å˜æ ¸å¿ƒæƒ…èŠ‚
   - ä¿ç•™å…³é”®ä¿¡æ¯ç‚¹
   - ç»´æŒè§’è‰²æ€§æ ¼
   - ç¡®ä¿é€»è¾‘è¿è´¯

ä¿®æ”¹é£æ ¼ï¼š
- åƒæ˜¯ä¸€ä¸ªå–œæ¬¢è®²æ•…äº‹çš„æ™®é€šäººå†™çš„
- æœ‰ç‚¹ç²—ç³™ä½†å¾ˆçœŸè¯š
- è‡ªç„¶æµç•…ä¸åˆ»æ„
- è®©äººè¯»èµ·æ¥å¾ˆèˆ’æœ

è¯·ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„æ–‡æœ¬ï¼Œæ— éœ€è§£é‡Šã€‚"""

    # ç« èŠ‚å®Œæ•´åˆ›ä½œæç¤ºè¯
    CHAPTER_GENERATION = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å°è¯´ä½œå®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯åˆ›ä½œæœ¬ç« å†…å®¹ï¼š

é¡¹ç›®ä¿¡æ¯ï¼š
- ä¹¦åï¼š{title}
- ä¸»é¢˜ï¼š{theme}
- ç±»å‹ï¼š{genre}
- å™äº‹è§†è§’ï¼š{narrative_perspective}

ä¸–ç•Œè§‚ï¼š
- æ—¶é—´èƒŒæ™¯ï¼š{time_period}
- åœ°ç†ä½ç½®ï¼š{location}
- æ°›å›´åŸºè°ƒï¼š{atmosphere}
- ä¸–ç•Œè§„åˆ™ï¼š{rules}

è§’è‰²ä¿¡æ¯ï¼š
{characters_info}

å…¨ä¹¦å¤§çº²ï¼š
{outlines_context}

æœ¬ç« ä¿¡æ¯ï¼š
- ç« èŠ‚åºå·ï¼šç¬¬{chapter_number}ç« 
- ç« èŠ‚æ ‡é¢˜ï¼š{chapter_title}
- ç« èŠ‚å¤§çº²ï¼š{chapter_outline}

åˆ›ä½œè¦æ±‚ï¼š
1. ä¸¥æ ¼æŒ‰ç…§å¤§çº²å†…å®¹å±•å¼€æƒ…èŠ‚
2. ä¿æŒä¸å‰åç« èŠ‚çš„è¿è´¯æ€§
3. ç¬¦åˆè§’è‰²æ€§æ ¼è®¾å®š
4. ä½“ç°ä¸–ç•Œè§‚ç‰¹è‰²
5. ä½¿ç”¨{narrative_perspective}è§†è§’
6. **å­—æ•°è¦æ±‚ï¼šç›®æ ‡{target_word_count}å­—ï¼Œä¸å¾—ä½äº{target_word_count}å­—ï¼Œå»ºè®®æ§åˆ¶åœ¨{target_word_count}è‡³{max_word_count}å­—ä¹‹é—´**
7. è¯­è¨€è‡ªç„¶æµç•…ï¼Œé¿å…AIç—•è¿¹

è¯·ç›´æ¥è¾“å‡ºç« èŠ‚æ­£æ–‡å†…å®¹ï¼Œä¸è¦åŒ…å«ç« èŠ‚æ ‡é¢˜å’Œå…¶ä»–è¯´æ˜æ–‡å­—ã€‚"""

    # ç« èŠ‚å®Œæ•´åˆ›ä½œæç¤ºè¯ï¼ˆå¸¦å‰ç½®ç« èŠ‚ä¸Šä¸‹æ–‡å’Œè®°å¿†å¢å¼ºï¼‰
    CHAPTER_GENERATION_WITH_CONTEXT = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å°è¯´ä½œå®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯åˆ›ä½œæœ¬ç« å†…å®¹ï¼š

é¡¹ç›®ä¿¡æ¯ï¼š
- ä¹¦åï¼š{title}
- ä¸»é¢˜ï¼š{theme}
- ç±»å‹ï¼š{genre}
- å™äº‹è§†è§’ï¼š{narrative_perspective}

ä¸–ç•Œè§‚ï¼š
- æ—¶é—´èƒŒæ™¯ï¼š{time_period}
- åœ°ç†ä½ç½®ï¼š{location}
- æ°›å›´åŸºè°ƒï¼š{atmosphere}
- ä¸–ç•Œè§„åˆ™ï¼š{rules}

è§’è‰²ä¿¡æ¯ï¼š
{characters_info}

å…¨ä¹¦å¤§çº²ï¼š
{outlines_context}

ã€å·²å®Œæˆçš„å‰ç½®ç« èŠ‚å†…å®¹ã€‘
{previous_content}

ã€ğŸ§  æ™ºèƒ½è®°å¿†ç³»ç»Ÿ - é‡è¦å‚è€ƒã€‘
ä»¥ä¸‹æ˜¯ä»æ•…äº‹è®°å¿†åº“ä¸­æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ï¼Œè¯·åœ¨åˆ›ä½œæ—¶é€‚å½“å‚è€ƒå’Œå‘¼åº”ï¼š

{memory_context}

æœ¬ç« ä¿¡æ¯ï¼š
- ç« èŠ‚åºå·ï¼šç¬¬{chapter_number}ç« 
- ç« èŠ‚æ ‡é¢˜ï¼š{chapter_title}
- ç« èŠ‚å¤§çº²ï¼š{chapter_outline}

åˆ›ä½œè¦æ±‚ï¼š
1. **å‰§æƒ…è¿è´¯æ€§ï¼ˆæœ€é‡è¦ï¼‰**ï¼š
- å¿…é¡»æ‰¿æ¥å‰é¢ç« èŠ‚çš„å‰§æƒ…å‘å±•
- æ³¨æ„è§’è‰²çŠ¶æ€ã€æƒ…èŠ‚è¿›å±•ã€æ—¶é—´çº¿çš„è¿ç»­æ€§
- ä¸èƒ½å‡ºç°ä¸å‰æ–‡çŸ›ç›¾çš„å†…å®¹
- è‡ªç„¶è¿‡æ¸¡ï¼Œé¿å…çªå…€çš„è·³è·ƒ

2. **æƒ…èŠ‚æ¨è¿›**ï¼š
- ä¸¥æ ¼æŒ‰ç…§æœ¬ç« å¤§çº²å±•å¼€æƒ…èŠ‚
- æ¨åŠ¨æ•…äº‹å‘å‰å‘å±•
- ä¿æŒä¸å…¨ä¹¦å¤§çº²çš„ä¸€è‡´æ€§

3. **è§’è‰²ä¸€è‡´æ€§**ï¼š
- ç¬¦åˆè§’è‰²æ€§æ ¼è®¾å®š
- å»¶ç»­è§’è‰²åœ¨å‰æ–‡ä¸­çš„æˆé•¿å’Œå˜åŒ–
- ä¿æŒè§’è‰²å…³ç³»çš„è¿è´¯æ€§

4. **å†™ä½œé£æ ¼**ï¼š
- ä½¿ç”¨{narrative_perspective}è§†è§’
- **å­—æ•°è¦æ±‚ï¼šç›®æ ‡{target_word_count}å­—ï¼Œä¸å¾—ä½äº{target_word_count}å­—ï¼Œå»ºè®®æ§åˆ¶åœ¨{target_word_count}è‡³{max_word_count}å­—ä¹‹é—´**
- è¯­è¨€è‡ªç„¶æµç•…ï¼Œé¿å…AIç—•è¿¹
- ä½“ç°ä¸–ç•Œè§‚ç‰¹è‰²

5. **æ‰¿ä¸Šå¯ä¸‹**ï¼š
   - å¼€å¤´è‡ªç„¶è¡”æ¥ä¸Šä¸€ç« ç»“å°¾
   - ç»“å°¾ä¸ºä¸‹ä¸€ç« åšå¥½é“ºå«

6. **è®°å¿†ç³»ç»Ÿä½¿ç”¨æŒ‡å—**ï¼š
   - **æœ€è¿‘ç« èŠ‚è®°å¿†**ï¼šä¿æŒæƒ…èŠ‚è¿è´¯ï¼Œæ³¨æ„è§’è‰²çŠ¶æ€å’Œå‰§æƒ…å‘å±•
   - **è¯­ä¹‰ç›¸å…³è®°å¿†**ï¼šå‚è€ƒç›¸ä¼¼æƒ…èŠ‚çš„å¤„ç†æ–¹å¼
   - **æœªå®Œç»“ä¼ç¬”**ï¼šé€‚å½“æ—¶æœºå¯ä»¥å›æ”¶ä¼ç¬”ï¼Œåˆ¶é€ å‘¼åº”æ•ˆæœ
   - **è§’è‰²çŠ¶æ€è®°å¿†**ï¼šç¡®ä¿è§’è‰²è¡Œä¸ºç¬¦åˆå…¶å‘å±•è½¨è¿¹
   - **é‡è¦æƒ…èŠ‚ç‚¹**ï¼šä¸å…³é”®å‰§æƒ…ä¿æŒä¸€è‡´

è¯·ç›´æ¥è¾“å‡ºç« èŠ‚æ­£æ–‡å†…å®¹ï¼Œä¸è¦åŒ…å«ç« èŠ‚æ ‡é¢˜å’Œå…¶ä»–è¯´æ˜æ–‡å­—ã€‚"""

    # å¤§çº²ç”Ÿæˆæç¤ºè¯
    OUTLINE_GENERATION = """ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å°è¯´ä½œå®¶å’Œç¼–å‰§ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆå°è¯´å¤§çº²ï¼š

ç±»å‹ï¼š{genre}
ä¸»é¢˜ï¼š{theme}
ç›®æ ‡å­—æ•°ï¼š{target_words}
å…¶ä»–è¦æ±‚ï¼š{requirements}

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ç« èŠ‚å¤§çº²æ¡†æ¶ï¼ŒåŒ…å«ï¼š
1. åˆç†çš„ç« èŠ‚æ•°é‡ï¼ˆæ ¹æ®å­—æ•°ï¼‰
2. æ¯ç« çš„æ ‡é¢˜å’Œå†…å®¹æ¦‚è¦
3. æ¸…æ™°çš„æ•…äº‹ç»“æ„ï¼ˆèµ·æ‰¿è½¬åˆï¼‰
4. æƒ…èŠ‚çš„é€’è¿›å’Œå†²çªå‡çº§
5. è§’è‰²çš„æˆé•¿å¼§çº¿

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. ä¸“æœ‰åè¯å’Œå¼ºè°ƒå†…å®¹ä½¿ç”¨ã€ã€‘æ ‡è®°

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{{
  "chapters": [
    {{
      "order": 1,
      "title": "ç« èŠ‚æ ‡é¢˜",
      "content": "ç« èŠ‚å†…å®¹æ¦‚è¦ï¼ˆ150-200å­—ï¼‰"
    }}
  ]
}}

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONå¯¹è±¡ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. ä¸è¦æœ‰ä»»ä½•é¢å¤–çš„æ–‡å­—è¯´æ˜"""

    # å•ä¸ªè§’è‰²ç”Ÿæˆæç¤ºè¯
    SINGLE_CHARACTER_GENERATION = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è§’è‰²è®¾å®šå¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯åˆ›å»ºä¸€ä¸ªç«‹ä½“é¥±æ»¡çš„å°è¯´è§’è‰²ã€‚

{project_context}

{user_input}

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„è§’è‰²å¡ç‰‡ï¼ŒåŒ…å«ä»¥ä¸‹æ‰€æœ‰ä¿¡æ¯ï¼š

1. **åŸºæœ¬ä¿¡æ¯**ï¼š
   - å§“åï¼šå¦‚æœç”¨æˆ·æœªæä¾›ï¼Œè¯·ç”Ÿæˆä¸€ä¸ªç¬¦åˆä¸–ç•Œè§‚çš„åå­—
   - å¹´é¾„ï¼šå…·ä½“æ•°å­—æˆ–å¹´é¾„æ®µ
   - æ€§åˆ«ï¼šç”·/å¥³/å…¶ä»–

2. **å¤–è²Œç‰¹å¾**ï¼ˆ100-150å­—ï¼‰ï¼š
   - èº«é«˜ä½“å‹ã€é¢å®¹ç‰¹å¾ã€ç€è£…é£æ ¼
   - è¦ç¬¦åˆè§’è‰²å®šä½å’Œä¸–ç•Œè§‚è®¾å®š

3. **æ€§æ ¼ç‰¹ç‚¹**ï¼ˆ150-200å­—ï¼‰ï¼š
   - æ ¸å¿ƒæ€§æ ¼ç‰¹è´¨ï¼ˆè‡³å°‘3ä¸ªï¼‰
   - ä¼˜ç‚¹å’Œç¼ºç‚¹
   - ç‰¹æ®Šä¹ æƒ¯æˆ–ç™–å¥½
   - æ€§æ ¼è¦æœ‰å¤æ‚æ€§å’ŒçŸ›ç›¾æ€§

4. **èƒŒæ™¯æ•…äº‹**ï¼ˆ200-300å­—ï¼‰ï¼š
   - å®¶åº­èƒŒæ™¯
   - æˆé•¿ç»å†
   - é‡è¦è½¬æŠ˜äº‹ä»¶
   - å¦‚ä½•ä¸é¡¹ç›®ä¸»é¢˜å…³è”
   - èå…¥ç”¨æˆ·æä¾›çš„èƒŒæ™¯è®¾å®š

5. **äººé™…å…³ç³»**ï¼š
   - ä¸ç°æœ‰è§’è‰²çš„å…³ç³»ï¼ˆå¦‚æœæœ‰ï¼‰
   - é‡è¦çš„äººé™…çº½å¸¦
   - ç¤¾ä¼šåœ°ä½å’Œäººè„‰

6. **ç‰¹æ®Šèƒ½åŠ›/ç‰¹é•¿**ï¼š
   - æ“…é•¿çš„é¢†åŸŸ
   - ç‰¹æ®ŠæŠ€èƒ½æˆ–çŸ¥è¯†
   - ç¬¦åˆä¸–ç•Œè§‚è®¾å®š

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. æ–‡æœ¬æè¿°ä¸­çš„ä¸“æœ‰åè¯ä½¿ç”¨ã€ã€‘æ ‡è®°

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{{
  "name": "è§’è‰²å§“å",
  "age": "å¹´é¾„",
  "gender": "æ€§åˆ«",
  "appearance": "å¤–è²Œæè¿°ï¼ˆ100-150å­—ï¼‰",
  "personality": "æ€§æ ¼ç‰¹ç‚¹ï¼ˆ150-200å­—ï¼‰",
  "background": "èƒŒæ™¯æ•…äº‹ï¼ˆ200-300å­—ï¼‰",
  "traits": ["ç‰¹é•¿1", "ç‰¹é•¿2", "ç‰¹é•¿3"],
  
  "relationships_text": "äººé™…å…³ç³»çš„æ–‡å­—æè¿°ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰",
  
  "relationships": [
    {{
      "target_character_name": "å·²å­˜åœ¨çš„è§’è‰²åç§°",
      "relationship_type": "å…³ç³»ç±»å‹ï¼ˆå¦‚ï¼šå¸ˆçˆ¶ã€æœ‹å‹ã€æ•Œäººã€çˆ¶äº²ã€æ¯äº²ç­‰ï¼‰",
      "intimacy_level": 75,
      "description": "è¿™æ®µå…³ç³»çš„è¯¦ç»†æè¿°",
      "started_at": "å…³ç³»å¼€å§‹çš„æ•…äº‹æ—¶é—´ç‚¹ï¼ˆå¯é€‰ï¼‰"
    }}
  ],
  
  "organization_memberships": [
    {{
      "organization_name": "å·²å­˜åœ¨çš„ç»„ç»‡åç§°",
      "position": "èŒä½åç§°",
      "rank": 8,
      "loyalty": 80,
      "joined_at": "åŠ å…¥æ—¶é—´ï¼ˆå¯é€‰ï¼‰",
      "status": "active"
    }}
  ]
}}

**å…³ç³»ç±»å‹å‚è€ƒï¼ˆè¯·ä»ä¸­é€‰æ‹©æˆ–è‡ªå®šä¹‰ï¼‰ï¼š**
- å®¶æ—å…³ç³»ï¼šçˆ¶äº²ã€æ¯äº²ã€å…„å¼Ÿã€å§å¦¹ã€å­å¥³ã€é…å¶ã€æ‹äºº
- ç¤¾äº¤å…³ç³»ï¼šå¸ˆçˆ¶ã€å¾’å¼Ÿã€æœ‹å‹ã€åŒå­¦ã€åŒäº‹ã€é‚»å±…ã€çŸ¥å·±
- èŒä¸šå…³ç³»ï¼šä¸Šå¸ã€ä¸‹å±ã€åˆä½œä¼™ä¼´
- æ•Œå¯¹å…³ç³»ï¼šæ•Œäººã€ä»‡äººã€ç«äº‰å¯¹æ‰‹ã€å®¿æ•Œ

**é‡è¦è¯´æ˜ï¼š**
1. relationshipsæ•°ç»„ï¼šåªåŒ…å«ä¸ä¸Šé¢åˆ—å‡ºçš„å·²å­˜åœ¨è§’è‰²çš„å…³ç³»ï¼Œé€šè¿‡target_character_nameåŒ¹é…
2. organization_membershipsæ•°ç»„ï¼šåªåŒ…å«ä¸ä¸Šé¢åˆ—å‡ºçš„å·²å­˜åœ¨ç»„ç»‡çš„å…³ç³»
3. intimacy_levelæ˜¯-100åˆ°100çš„æ•´æ•°ï¼ˆè´Ÿå€¼è¡¨ç¤ºæ•Œå¯¹ã€ä»‡æ¨ç­‰å…³ç³»ï¼‰ï¼Œloyaltyæ˜¯0-100çš„æ•´æ•°
4. å¦‚æœæ²¡æœ‰å…³ç³»æˆ–ç»„ç»‡ï¼Œå¯¹åº”æ•°ç»„ä¸ºç©º[]
5. relationships_textæ˜¯è‡ªç„¶è¯­è¨€æè¿°ï¼Œç”¨äºå±•ç¤ºç»™ç”¨æˆ·çœ‹

**è§’è‰²è®¾å®šè¦æ±‚ï¼š**
- è§’è‰²è¦ç¬¦åˆé¡¹ç›®çš„ä¸–ç•Œè§‚å’Œä¸»é¢˜
- å¦‚æœæ˜¯ä¸»è§’ï¼Œè¦æœ‰æ˜ç¡®çš„æˆé•¿ç©ºé—´å’Œç›®æ ‡åŠ¨æœº
- å¦‚æœæ˜¯åæ´¾ï¼Œè¦æœ‰åˆç†çš„åŠ¨æœºï¼Œä¸èƒ½è„¸è°±åŒ–
- é…è§’è¦æœ‰ç‹¬ç‰¹æ€§ï¼Œä¸èƒ½æ˜¯å·¥å…·äºº
- æ‰€æœ‰è®¾å®šè¦ä¸ºæ•…äº‹æœåŠ¡

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONå¯¹è±¡ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. ä¸è¦æœ‰ä»»ä½•é¢å¤–çš„æ–‡å­—è¯´æ˜"""

    # å•ä¸ªç»„ç»‡ç”Ÿæˆæç¤ºè¯
    SINGLE_ORGANIZATION_GENERATION = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç»„ç»‡è®¾å®šå¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ç»„ç»‡/åŠ¿åŠ›è®¾å®šã€‚

{project_context}

{user_input}

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ç»„ç»‡è®¾å®šï¼ŒåŒ…å«ä»¥ä¸‹æ‰€æœ‰ä¿¡æ¯ï¼š

1. **åŸºæœ¬ä¿¡æ¯**ï¼š
   - ç»„ç»‡åç§°ï¼šå¦‚æœç”¨æˆ·æœªæä¾›ï¼Œè¯·ç”Ÿæˆä¸€ä¸ªç¬¦åˆä¸–ç•Œè§‚çš„åç§°
   - ç»„ç»‡ç±»å‹ï¼šå¦‚å¸®æ´¾ã€å…¬å¸ã€é—¨æ´¾ã€å­¦é™¢ã€æ”¿åºœæœºæ„ã€å®—æ•™ç»„ç»‡ç­‰
   - æˆç«‹æ—¶é—´ï¼šå…·ä½“æ—¶é—´æˆ–æ—¶é—´æ®µ

2. **ç»„ç»‡ç‰¹æ€§**ï¼ˆ150-200å­—ï¼‰ï¼š
   - ç»„ç»‡çš„æ ¸å¿ƒç†å¿µå’Œè¡Œäº‹é£æ ¼
   - ç»„ç»‡æ–‡åŒ–å’Œä»·å€¼è§‚
   - è¿ä½œæ–¹å¼å’Œç®¡ç†æ¨¡å¼
   - ç‰¹æ®Šä¼ ç»Ÿæˆ–è§„çŸ©

3. **ç»„ç»‡èƒŒæ™¯**ï¼ˆ200-300å­—ï¼‰ï¼š
   - å»ºç«‹å†å²å’Œèµ·æº
   - å‘å±•å†ç¨‹å’Œé‡è¦äº‹ä»¶
   - ç›®å‰çš„åœ°ä½å’Œå½±å“åŠ›
   - å¦‚ä½•ä¸é¡¹ç›®ä¸»é¢˜å…³è”
   - èå…¥ç”¨æˆ·æä¾›çš„èƒŒæ™¯è®¾å®š

4. **å¤–åœ¨è¡¨ç°**ï¼ˆ100-150å­—ï¼‰ï¼š
   - æ€»éƒ¨æˆ–ä¸»è¦æ®ç‚¹ä½ç½®
   - æ ‡å¿—æ€§å»ºç­‘æˆ–åœºæ‰€
   - ç»„ç»‡æ ‡å¿—ã€å¾½ç« ã€åˆ¶æœç­‰
   - å¯è¾¨è¯†çš„å¤–åœ¨ç‰¹å¾

5. **ç»„ç»‡ç›®çš„/å®—æ—¨**ï¼š
   - æ˜ç¡®çš„ç»„ç»‡ç›®æ ‡
   - é•¿æœŸæ„¿æ™¯
   - è¡ŒåŠ¨å‡†åˆ™

6. **åŠ¿åŠ›ç­‰çº§**ï¼š
   - åœ¨ä¸–ç•Œä¸­çš„å½±å“åŠ›ï¼ˆ0-100ï¼‰
   - ç»¼åˆå®åŠ›è¯„ä¼°

7. **æ‰€åœ¨åœ°ç‚¹**ï¼š
   - ä¸»è¦æ´»åŠ¨åŒºåŸŸ
   - åŠ¿åŠ›èŒƒå›´

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. æ–‡æœ¬æè¿°ä¸­çš„ä¸“æœ‰åè¯ä½¿ç”¨ã€ã€‘æ ‡è®°

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{{
  "name": "ç»„ç»‡åç§°",
  "is_organization": true,
  "organization_type": "ç»„ç»‡ç±»å‹",
  "personality": "ç»„ç»‡ç‰¹æ€§ï¼ˆ150-200å­—ï¼‰",
  "background": "ç»„ç»‡èƒŒæ™¯ï¼ˆ200-300å­—ï¼‰",
  "appearance": "å¤–åœ¨è¡¨ç°ï¼ˆ100-150å­—ï¼‰",
  "organization_purpose": "ç»„ç»‡ç›®çš„å’Œå®—æ—¨",
  "power_level": 75,
  "location": "æ‰€åœ¨åœ°ç‚¹",
  "motto": "ç»„ç»‡æ ¼è¨€æˆ–å£å·",
  "traits": ["ç‰¹å¾1", "ç‰¹å¾2", "ç‰¹å¾3"],
  "color": "ç»„ç»‡ä»£è¡¨é¢œè‰²ï¼ˆå¦‚ï¼šæ·±çº¢è‰²ã€é‡‘è‰²ã€é»‘è‰²ç­‰ï¼‰",
  "organization_members": ["é‡è¦æˆå‘˜1", "é‡è¦æˆå‘˜2", "é‡è¦æˆå‘˜3"]
}}

**ç»„ç»‡è®¾å®šè¦æ±‚ï¼š**
- ç»„ç»‡è¦ç¬¦åˆé¡¹ç›®çš„ä¸–ç•Œè§‚å’Œä¸»é¢˜
- ç›®æ ‡å’Œè¡ŒåŠ¨è¦åˆç†ï¼Œä¸èƒ½è¿‡äºç†æƒ³åŒ–æˆ–è„¸è°±åŒ–
- è¦æœ‰å­˜åœ¨çš„å¿…è¦æ€§ï¼Œèƒ½æ¨åŠ¨æ•…äº‹å‘å±•
- å†…éƒ¨è¦æœ‰å±‚çº§å’Œç»“æ„
- ä¸å…¶ä»–åŠ¿åŠ›è¦æœ‰äº’åŠ¨å…³ç³»

**è¯´æ˜**ï¼š
1. power_levelæ˜¯0-100çš„æ•´æ•°ï¼Œè¡¨ç¤ºç»„ç»‡åœ¨ä¸–ç•Œä¸­çš„å½±å“åŠ›
2. organization_membersæ˜¯ç»„ç»‡å†…é‡è¦æˆå‘˜çš„åå­—åˆ—è¡¨ï¼ˆå¦‚æœå·²æœ‰è§’è‰²ï¼Œå¯ä»¥å…³è”ï¼‰
3. æ‰€æœ‰æ–‡æœ¬æè¿°è¦è¯¦ç»†å…·ä½“ï¼Œé¿å…ç©ºæ³›

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONå¯¹è±¡ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. ä¸è¦æœ‰ä»»ä½•é¢å¤–çš„æ–‡å­—è¯´æ˜"""
    
    # å¤§çº²å±•å¼€ä¸ºå¤šç« èŠ‚çš„æç¤ºè¯
    OUTLINE_EXPANSION = """ä½ æ˜¯ä¸“ä¸šçš„å°è¯´æƒ…èŠ‚æ¶æ„å¸ˆã€‚è¯·åˆ†æä»¥ä¸‹å¤§çº²èŠ‚ç‚¹ï¼Œå°†å…¶å±•å¼€ä¸º {target_chapters} ä¸ªç« èŠ‚çš„è¯¦ç»†è§„åˆ’ã€‚

ã€é¡¹ç›®ä¿¡æ¯ã€‘
å°è¯´åç§°ï¼š{title}
ç±»å‹ï¼š{genre}
ä¸»é¢˜ï¼š{theme}
å™äº‹è§†è§’ï¼š{narrative_perspective}

ã€ä¸–ç•Œè§‚èƒŒæ™¯ã€‘
æ—¶é—´èƒŒæ™¯ï¼š{time_period}
åœ°ç†ä½ç½®ï¼š{location}
æ°›å›´åŸºè°ƒï¼š{atmosphere}
ä¸–ç•Œè§„åˆ™ï¼š{rules}

ã€è§’è‰²ä¿¡æ¯ã€‘
{characters_info}

ã€å¤§çº²èŠ‚ç‚¹ã€‘
åºå·ï¼šç¬¬ {outline_order} èŠ‚
æ ‡é¢˜ï¼š{outline_title}
å†…å®¹ï¼š{outline_content}

ã€ä¸Šä¸‹æ–‡ã€‘
{context_info}

ã€å±•å¼€ç­–ç•¥ã€‘
{strategy_instruction}

ã€ä»»åŠ¡è¦æ±‚ã€‘
1. æ·±åº¦åˆ†æè¯¥å¤§çº²çš„å‰§æƒ…å®¹é‡å’Œå™äº‹èŠ‚å¥
2. è¯†åˆ«å…³é”®å‰§æƒ…ç‚¹ã€å†²çªç‚¹å’Œæƒ…æ„Ÿè½¬æŠ˜ç‚¹
3. å°†å¤§çº²æ‹†è§£ä¸º {target_chapters} ä¸ªç« èŠ‚ï¼Œæ¯ç« éœ€åŒ…å«ï¼š
   - sub_index: å­ç« èŠ‚åºå·ï¼ˆ1, 2, 3...ï¼‰
   - title: ç« èŠ‚æ ‡é¢˜ï¼ˆä½“ç°è¯¥ç« æ ¸å¿ƒå†²çªæˆ–æƒ…æ„Ÿï¼‰
   - plot_summary: å‰§æƒ…æ‘˜è¦ï¼ˆ200-300å­—ï¼Œè¯¦ç»†æè¿°è¯¥ç« å‘ç”Ÿçš„äº‹ä»¶ï¼‰
   - key_events: å…³é”®äº‹ä»¶åˆ—è¡¨ï¼ˆ3-5ä¸ªå…³é”®å‰§æƒ…ç‚¹ï¼‰
   - character_focus: è§’è‰²ç„¦ç‚¹ï¼ˆä¸»è¦æ¶‰åŠçš„è§’è‰²åç§°ï¼‰
   - emotional_tone: æƒ…æ„ŸåŸºè°ƒï¼ˆå¦‚ï¼šç´§å¼ ã€æ¸©é¦¨ã€æ‚²ä¼¤ã€æ¿€åŠ¨ç­‰ï¼‰
   - narrative_goal: å™äº‹ç›®æ ‡ï¼ˆè¯¥ç« è¦è¾¾æˆçš„å™äº‹æ•ˆæœï¼‰
   - conflict_type: å†²çªç±»å‹ï¼ˆå¦‚ï¼šå†…å¿ƒæŒ£æ‰ã€äººé™…å†²çªã€ç¯å¢ƒæŒ‘æˆ˜ç­‰ï¼‰
   - estimated_words: é¢„è®¡å­—æ•°ï¼ˆå»ºè®®2000-5000å­—ï¼‰
{scene_instruction}
4. ç¡®ä¿ç« èŠ‚é—´ï¼š
   - è¡”æ¥è‡ªç„¶æµç•…
   - å‰§æƒ…é€’è¿›åˆç†
   - èŠ‚å¥å¼ å¼›æœ‰åº¦
   - æ¯ç« éƒ½æœ‰æ˜ç¡®çš„å™äº‹ä»·å€¼

**é‡è¦æ ¼å¼è¦æ±‚ï¼š**
1. åªè¿”å›çº¯JSONæ•°ç»„æ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°ã€ä»£ç å—æ ‡è®°æˆ–å…¶ä»–è¯´æ˜æ–‡å­—
2. ä¸è¦åœ¨JSONå­—ç¬¦ä¸²å€¼ä¸­ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""''ï¼‰ï¼Œè¯·ä½¿ç”¨ã€ã€‘æˆ–ã€Šã€‹
3. æ–‡æœ¬æè¿°ä¸­çš„ä¸“æœ‰åè¯ä½¿ç”¨ã€ã€‘æ ‡è®°

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼š
[
  {{
    "sub_index": 1,
    "title": "ç« èŠ‚æ ‡é¢˜",
    "plot_summary": "è¯¥ç« è¯¦ç»†å‰§æƒ…æ‘˜è¦ï¼ˆ200-300å­—ï¼‰...",
    "key_events": ["å…³é”®äº‹ä»¶1", "å…³é”®äº‹ä»¶2", "å…³é”®äº‹ä»¶3"],
    "character_focus": ["è§’è‰²A", "è§’è‰²B"],
    "emotional_tone": "æƒ…æ„ŸåŸºè°ƒ",
    "narrative_goal": "å™äº‹ç›®æ ‡",
    "conflict_type": "å†²çªç±»å‹",
    "estimated_words": 3000{scene_field}
  }}
]

å†æ¬¡å¼ºè°ƒï¼š
1. åªè¿”å›çº¯JSONæ•°ç»„ï¼Œä¸è¦æœ‰```json```è¿™æ ·çš„æ ‡è®°
2. æ•°ç»„ä¸­è¦åŒ…å«{target_chapters}ä¸ªç« èŠ‚å¯¹è±¡
3. æ¯ä¸ªplot_summaryå¿…é¡»æ˜¯200-300å­—çš„è¯¦ç»†æè¿°
4. æ–‡æœ¬ä¸­ä¸è¦ä½¿ç”¨ä¸­æ–‡å¼•å·ï¼ˆ""ï¼‰ï¼Œæ”¹ç”¨ã€ã€‘æˆ–ã€Šã€‹"""

    @staticmethod
    def format_prompt(template: str, **kwargs) -> str:
        """
        æ ¼å¼åŒ–æç¤ºè¯æ¨¡æ¿
        
        Args:
            template: æç¤ºè¯æ¨¡æ¿
            **kwargs: æ¨¡æ¿å‚æ•°
            
        Returns:
            æ ¼å¼åŒ–åçš„æç¤ºè¯
        """
        try:
            return template.format(**kwargs)
        except KeyError as e:
            raise ValueError(f"ç¼ºå°‘å¿…éœ€çš„å‚æ•°: {e}")
    
    @classmethod
    def get_denoising_prompt(cls, original_text: str) -> str:
        """è·å–AIå»å‘³æç¤ºè¯"""
        return cls.format_prompt(
            cls.AI_DENOISING,
            original_text=original_text
        )
    
    @classmethod
    def get_world_building_prompt(cls, title: str, theme: str, genre: str = "") -> str:
        """è·å–ä¸–ç•Œæ„å»ºæç¤ºè¯"""
        return cls.format_prompt(
            cls.WORLD_BUILDING,
            title=title,
            theme=theme,
            genre=genre or "é€šç”¨ç±»å‹"
        )
    
    @classmethod
    def get_characters_batch_prompt(cls, count: int, time_period: str, location: str,
                                   atmosphere: str, rules: str, theme: str,
                                   genre: str = "", requirements: str = "") -> str:
        """è·å–æ‰¹é‡è§’è‰²ç”Ÿæˆæç¤ºè¯"""
        return cls.format_prompt(
            cls.CHARACTERS_BATCH_GENERATION,
            count=count,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            theme=theme,
            genre=genre or "é€šç”¨ç±»å‹",
            requirements=requirements or "æ— ç‰¹æ®Šè¦æ±‚"
        )
    
    @classmethod
    def get_complete_outline_prompt(cls, title: str, theme: str, genre: str,
                                   chapter_count: int, narrative_perspective: str,
                                   target_words: int, time_period: str, location: str,
                                   atmosphere: str, rules: str, characters_info: str,
                                   requirements: str = "",
                                   mcp_references: str = "") -> str:
        """è·å–å‘å¯¼å¤§çº²ç”Ÿæˆæç¤ºè¯ï¼ˆæ”¯æŒMCPå¢å¼ºï¼‰"""
        # æ ¼å¼åŒ–MCPå‚è€ƒèµ„æ–™
        mcp_text = ""
        if mcp_references:
            mcp_text = "ã€ğŸ“š MCPå·¥å…·æœç´¢ - æƒ…èŠ‚è®¾è®¡å‚è€ƒã€‘\n"
            mcp_text += "ä»¥ä¸‹æ˜¯é€šè¿‡MCPå·¥å…·æœç´¢åˆ°çš„æƒ…èŠ‚è®¾è®¡å‚è€ƒèµ„æ–™ï¼Œå¯ç”¨äºè®¾è®¡å¤§çº²ç»“æ„å’Œæƒ…èŠ‚å‘å±•ï¼š\n\n"
            mcp_text += mcp_references
            mcp_text += "\n"
        
        return cls.format_prompt(
            cls.COMPLETE_OUTLINE_GENERATION,
            title=title,
            theme=theme,
            genre=genre,
            chapter_count=chapter_count,
            narrative_perspective=narrative_perspective,
            target_words=target_words,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            characters_info=characters_info,
            mcp_references=mcp_text,
            requirements=requirements or "æ— ç‰¹æ®Šè¦æ±‚"
        )
    
    @classmethod
    def get_chapter_generation_prompt(cls, title: str, theme: str, genre: str,
                                      narrative_perspective: str, time_period: str,
                                      location: str, atmosphere: str, rules: str,
                                      characters_info: str, outlines_context: str,
                                      chapter_number: int, chapter_title: str,
                                      chapter_outline: str, style_content: str = "",
                                      target_word_count: int = 3000,
                                      memory_context: dict = None,
                                      mcp_references: str = "") -> str:
        """
        è·å–ç« èŠ‚å®Œæ•´åˆ›ä½œæç¤ºè¯
        
        Args:
            style_content: å†™ä½œé£æ ¼è¦æ±‚å†…å®¹ï¼Œå¦‚æœæä¾›åˆ™ä¼šè¿½åŠ åˆ°æç¤ºè¯ä¸­
            target_word_count: ç›®æ ‡å­—æ•°ï¼Œé»˜è®¤3000å­—
            memory_context: è®°å¿†ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
            mcp_references: MCPå·¥å…·æœç´¢çš„å‚è€ƒèµ„æ–™ï¼ˆå¯é€‰ï¼‰
        """
        # è®¡ç®—æœ€å¤§å­—æ•°ï¼ˆç›®æ ‡å­—æ•°+1000ï¼‰
        max_word_count = target_word_count + 1000
        
        # æ ¼å¼åŒ–è®°å¿†ä¸Šä¸‹æ–‡
        memory_text = ""
        if memory_context:
            memory_text = "\nã€ğŸ§  æ™ºèƒ½è®°å¿†ç³»ç»Ÿ - é‡è¦å‚è€ƒã€‘\n"
            memory_text += memory_context.get('recent_context', '')
            memory_text += "\n" + memory_context.get('relevant_memories', '')
            memory_text += "\n" + memory_context.get('foreshadows', '')
            memory_text += "\n" + memory_context.get('character_states', '')
            memory_text += "\n" + memory_context.get('plot_points', '')
        
        # æ ¼å¼åŒ–MCPå‚è€ƒèµ„æ–™
        mcp_text = ""
        if mcp_references:
            mcp_text = "\nã€ğŸ“š MCPå·¥å…·æœç´¢ - å‚è€ƒèµ„æ–™ã€‘\n"
            mcp_text += "ä»¥ä¸‹æ˜¯é€šè¿‡MCPå·¥å…·æœç´¢åˆ°çš„ç›¸å…³å‚è€ƒèµ„æ–™ï¼Œå¯ç”¨äºä¸°å¯Œæƒ…èŠ‚å’Œç»†èŠ‚ï¼š\n\n"
            mcp_text += mcp_references
            mcp_text += "\n"
        
        base_prompt = cls.format_prompt(
            cls.CHAPTER_GENERATION,
            title=title,
            theme=theme,
            genre=genre,
            narrative_perspective=narrative_perspective,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            characters_info=characters_info,
            outlines_context=outlines_context,
            chapter_number=chapter_number,
            chapter_title=chapter_title,
            chapter_outline=chapter_outline,
            target_word_count=target_word_count,
            max_word_count=max_word_count
        )
        
        # æ’å…¥è®°å¿†ä¸Šä¸‹æ–‡å’ŒMCPå‚è€ƒèµ„æ–™
        insert_text = ""
        if memory_text:
            insert_text += memory_text
        if mcp_text:
            insert_text += mcp_text
        
        if insert_text:
            base_prompt = base_prompt.replace(
                "æœ¬ç« ä¿¡æ¯ï¼š",
                insert_text + "\n\næœ¬ç« ä¿¡æ¯ï¼š"
            )
        
        # å¦‚æœæœ‰é£æ ¼è¦æ±‚ï¼Œåº”ç”¨åˆ°æç¤ºè¯ä¸­
        if style_content:
            return WritingStyleManager.apply_style_to_prompt(base_prompt, style_content)
        
        return base_prompt
    
    @classmethod
    def get_chapter_generation_with_context_prompt(cls, title: str, theme: str, genre: str,
                                                   narrative_perspective: str, time_period: str,
                                                   location: str, atmosphere: str, rules: str,
                                                   characters_info: str, outlines_context: str,
                                                   previous_content: str, chapter_number: int,
                                                   chapter_title: str, chapter_outline: str,
                                                   style_content: str = "",
                                                   target_word_count: int = 3000,
                                                   memory_context: dict = None,
                                                   mcp_references: str = "") -> str:
        """
        è·å–ç« èŠ‚å®Œæ•´åˆ›ä½œæç¤ºè¯ï¼ˆå¸¦å‰ç½®ç« èŠ‚ä¸Šä¸‹æ–‡å’Œè®°å¿†å¢å¼ºï¼‰
        
        Args:
            style_content: å†™ä½œé£æ ¼è¦æ±‚å†…å®¹ï¼Œå¦‚æœæä¾›åˆ™ä¼šè¿½åŠ åˆ°æç¤ºè¯ä¸­
            target_word_count: ç›®æ ‡å­—æ•°ï¼Œé»˜è®¤3000å­—
            memory_context: è®°å¿†ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
            mcp_references: MCPå·¥å…·æœç´¢çš„å‚è€ƒèµ„æ–™ï¼ˆå¯é€‰ï¼‰
        """
        # è®¡ç®—æœ€å¤§å­—æ•°ï¼ˆç›®æ ‡å­—æ•°+1000ï¼‰
        max_word_count = target_word_count + 1000
        
        # æ ¼å¼åŒ–è®°å¿†ä¸Šä¸‹æ–‡
        memory_text = ""
        if memory_context:
            memory_text = memory_context.get('recent_context', '')
            memory_text += "\n" + memory_context.get('relevant_memories', '')
            memory_text += "\n" + memory_context.get('foreshadows', '')
            memory_text += "\n" + memory_context.get('character_states', '')
            memory_text += "\n" + memory_context.get('plot_points', '')
        else:
            memory_text = "æš‚æ— ç›¸å…³è®°å¿†"
        
        # æ ¼å¼åŒ–MCPå‚è€ƒèµ„æ–™
        if mcp_references:
            memory_text += "\n\nã€ğŸ“š MCPå·¥å…·æœç´¢ - å‚è€ƒèµ„æ–™ã€‘\n"
            memory_text += "ä»¥ä¸‹æ˜¯é€šè¿‡MCPå·¥å…·æœç´¢åˆ°çš„ç›¸å…³å‚è€ƒèµ„æ–™ï¼Œå¯ç”¨äºä¸°å¯Œæƒ…èŠ‚å’Œç»†èŠ‚ï¼š\n\n"
            memory_text += mcp_references
        
        base_prompt = cls.format_prompt(
            cls.CHAPTER_GENERATION_WITH_CONTEXT,
            title=title,
            theme=theme,
            genre=genre,
            narrative_perspective=narrative_perspective,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            characters_info=characters_info,
            outlines_context=outlines_context,
            previous_content=previous_content,
            chapter_number=chapter_number,
            chapter_title=chapter_title,
            chapter_outline=chapter_outline,
            target_word_count=target_word_count,
            max_word_count=max_word_count,
            memory_context=memory_text
        )
        
        # å¦‚æœæœ‰é£æ ¼è¦æ±‚ï¼Œåº”ç”¨åˆ°æç¤ºè¯ä¸­
        if style_content:
            return WritingStyleManager.apply_style_to_prompt(base_prompt, style_content)
        
        return base_prompt
    
    @classmethod
    def get_outline_prompt(cls, genre: str, theme: str, target_words: int,
                          requirements: str = "") -> str:
        """è·å–å¤§çº²ç”Ÿæˆæç¤ºè¯"""
        return cls.format_prompt(
            cls.OUTLINE_GENERATION,
            genre=genre,
            theme=theme,
            target_words=target_words,
            requirements=requirements or "æ— ç‰¹æ®Šè¦æ±‚"
        )
    
    @classmethod
    def get_outline_continue_prompt(cls, title: str, theme: str, genre: str,
                                    narrative_perspective: str, chapter_count: int,
                                    time_period: str, location: str, atmosphere: str,
                                    rules: str, characters_info: str,
                                    current_chapter_count: int, all_chapters_brief: str,
                                    recent_plot: str, plot_stage_instruction: str,
                                    start_chapter: int, story_direction: str,
                                    requirements: str = "",
                                    memory_context: dict = None,
                                    mcp_references: str = "") -> str:
        """è·å–å¤§çº²ç»­å†™æç¤ºè¯ï¼ˆæ”¯æŒè®°å¿†+MCPå¢å¼ºï¼‰"""
        end_chapter = start_chapter + chapter_count - 1
        
        # æ ¼å¼åŒ–è®°å¿†ä¸Šä¸‹æ–‡
        memory_text = ""
        if memory_context:
            memory_text = memory_context.get('recent_context', '')
            memory_text += "\n" + memory_context.get('relevant_memories', '')
            memory_text += "\n" + memory_context.get('foreshadows', '')
            memory_text += "\n" + memory_context.get('character_states', '')
            memory_text += "\n" + memory_context.get('plot_points', '')
        else:
            memory_text = "æš‚æ— ç›¸å…³è®°å¿†ï¼ˆå¯èƒ½æ˜¯é¦–æ¬¡ç»­å†™æˆ–è®°å¿†åº“ä¸ºç©ºï¼‰"
        
        # æ ¼å¼åŒ–MCPå‚è€ƒèµ„æ–™
        mcp_text = ""
        if mcp_references:
            mcp_text = "\n\nã€ğŸ“š MCPå·¥å…·æœç´¢ - ç»­å†™å‚è€ƒèµ„æ–™ã€‘\n"
            mcp_text += "ä»¥ä¸‹æ˜¯é€šè¿‡MCPå·¥å…·æœç´¢åˆ°çš„ç»­å†™å‚è€ƒèµ„æ–™ï¼Œå¯ç”¨äºä¸°å¯Œæƒ…èŠ‚å‘å±•å’Œå†²çªè®¾è®¡ï¼š\n\n"
            mcp_text += mcp_references
            mcp_text += "\n"
        
        return cls.format_prompt(
            cls.OUTLINE_CONTINUE_GENERATION,
            title=title,
            theme=theme,
            genre=genre,
            narrative_perspective=narrative_perspective,
            chapter_count=chapter_count,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            characters_info=characters_info,
            current_chapter_count=current_chapter_count,
            all_chapters_brief=all_chapters_brief,
            recent_plot=recent_plot,
            plot_stage_instruction=plot_stage_instruction,
            start_chapter=start_chapter,
            end_chapter=end_chapter,
            story_direction=story_direction,
            requirements=requirements or "æ— ç‰¹æ®Šè¦æ±‚",
            memory_context=memory_text,
            mcp_references=mcp_text
        )
    
    @classmethod
    def get_single_character_prompt(cls, project_context: str, user_input: str) -> str:
        """è·å–å•ä¸ªè§’è‰²ç”Ÿæˆæç¤ºè¯"""
        return cls.format_prompt(
            cls.SINGLE_CHARACTER_GENERATION,
            project_context=project_context,
            user_input=user_input
        )
    
    @classmethod
    def get_single_organization_prompt(cls, project_context: str, user_input: str) -> str:
        """è·å–å•ä¸ªç»„ç»‡ç”Ÿæˆæç¤ºè¯"""
        return cls.format_prompt(
            cls.SINGLE_ORGANIZATION_GENERATION,
            project_context=project_context,
            user_input=user_input
        )
    
    @classmethod
    def get_outline_expansion_prompt(cls, title: str, genre: str, theme: str,
                                    narrative_perspective: str, time_period: str,
                                    location: str, atmosphere: str, rules: str,
                                    characters_info: str, outline_order: int,
                                    outline_title: str, outline_content: str,
                                    context_info: str, strategy: str = "balanced",
                                    target_chapters: int = 3,
                                    include_scenes: bool = False) -> str:
        """
        è·å–å¤§çº²å±•å¼€ä¸ºå¤šç« èŠ‚çš„æç¤ºè¯
        
        Args:
            title: å°è¯´åç§°
            genre: ç±»å‹
            theme: ä¸»é¢˜
            narrative_perspective: å™äº‹è§†è§’
            time_period: æ—¶é—´èƒŒæ™¯
            location: åœ°ç†ä½ç½®
            atmosphere: æ°›å›´åŸºè°ƒ
            rules: ä¸–ç•Œè§„åˆ™
            characters_info: è§’è‰²ä¿¡æ¯
            outline_order: å¤§çº²åºå·
            outline_title: å¤§çº²æ ‡é¢˜
            outline_content: å¤§çº²å†…å®¹
            context_info: ä¸Šä¸‹æ–‡ä¿¡æ¯
            strategy: å±•å¼€ç­–ç•¥ (balanced/climax/detail)
            target_chapters: ç›®æ ‡ç« èŠ‚æ•°
            include_scenes: æ˜¯å¦åŒ…å«åœºæ™¯å­—æ®µ
        """
        # æ ¹æ®ç­–ç•¥ç”ŸæˆæŒ‡å¯¼è¯´æ˜
        strategy_instructions = {
            "balanced": "é‡‡ç”¨å‡è¡¡ç­–ç•¥ï¼šå°†å¤§çº²å†…å®¹å¹³å‡åˆ†é…åˆ°å„ç« èŠ‚ï¼Œä¿æŒèŠ‚å¥å‡åŒ€ï¼Œæ¯ç« å‰§æƒ…å¯†åº¦ç›¸å½“ã€‚",
            "climax": "é‡‡ç”¨é«˜æ½®é‡ç‚¹ç­–ç•¥ï¼šè¯†åˆ«å¤§çº²ä¸­çš„é«˜æ½®éƒ¨åˆ†ï¼Œä¸ºå…¶åˆ†é…æ›´å¤šç« èŠ‚è¿›è¡Œç»†è‡´å±•å¼€ï¼Œå…¶ä»–éƒ¨åˆ†é€‚å½“ç²¾ç®€ã€‚",
            "detail": "é‡‡ç”¨ç»†èŠ‚ä¸°å¯Œç­–ç•¥ï¼šæ·±æŒ–å¤§çº²ä¸­çš„æ¯ä¸ªç»†èŠ‚ï¼Œä¸ºæ¯ä¸ªå…³é”®äº‹ä»¶ã€æƒ…æ„Ÿè½¬æŠ˜éƒ½å®‰æ’è¶³å¤Ÿçš„å™äº‹ç©ºé—´ã€‚"
        }
        strategy_instruction = strategy_instructions.get(strategy, strategy_instructions["balanced"])
        
        # åœºæ™¯ç›¸å…³çš„æŒ‡ä»¤å’Œå­—æ®µ
        scene_instruction = ""
        scene_field = ""
        if include_scenes:
            scene_instruction = "\n   - scenes: åœºæ™¯åˆ—è¡¨ï¼ˆ2-4ä¸ªå…·ä½“åœºæ™¯æè¿°ï¼‰"
            scene_field = ',\n    "scenes": ["åœºæ™¯1", "åœºæ™¯2"]'
        
        return cls.format_prompt(
            cls.OUTLINE_EXPANSION,
            title=title,
            genre=genre,
            theme=theme,
            narrative_perspective=narrative_perspective,
            time_period=time_period,
            location=location,
            atmosphere=atmosphere,
            rules=rules,
            characters_info=characters_info,
            outline_order=outline_order,
            outline_title=outline_title,
            outline_content=outline_content,
            context_info=context_info,
            strategy_instruction=strategy_instruction,
            target_chapters=target_chapters,
            scene_instruction=scene_instruction,
            scene_field=scene_field
        )


# åˆ›å»ºå…¨å±€æç¤ºè¯æœåŠ¡å®ä¾‹
prompt_service = PromptService()